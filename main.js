/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var zs=Object.create;var Lt=Object.defineProperty;var Vs=Object.getOwnPropertyDescriptor;var Gs=Object.getOwnPropertyNames;var Ys=Object.getPrototypeOf,Qs=Object.prototype.hasOwnProperty;var k=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports),js=(c,e)=>{for(var r in e)Lt(c,r,{get:e[r],enumerable:!0})},On=(c,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Gs(e))!Qs.call(c,o)&&o!==r&&Lt(c,o,{get:()=>e[o],enumerable:!(i=Vs(e,o))||i.enumerable});return c};var Wn=(c,e,r)=>(r=c!=null?zs(Ys(c)):{},On(e||!c||!c.__esModule?Lt(r,"default",{value:c,enumerable:!0}):r,c)),Ks=c=>On(Lt({},"__esModule",{value:!0}),c);var Hn=k((Xa,$n)=>{$n.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var Ee=k(Ie=>{var Rr,Xs=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Ie.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};Ie.getSymbolTotalCodewords=function(e){return Xs[e]};Ie.getBCHDigit=function(c){let e=0;for(;c!==0;)e++,c>>>=1;return e};Ie.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Rr=e};Ie.isKanjiModeEnabled=function(){return typeof Rr<"u"};Ie.toSJIS=function(e){return Rr(e)}});var Ft=k(re=>{re.L={bit:1};re.M={bit:0};re.Q={bit:3};re.H={bit:2};function Js(c){if(typeof c!="string")throw new Error("Param is not a string");switch(c.toLowerCase()){case"l":case"low":return re.L;case"m":case"medium":return re.M;case"q":case"quartile":return re.Q;case"h":case"high":return re.H;default:throw new Error("Unknown EC Level: "+c)}}re.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4};re.from=function(e,r){if(re.isValid(e))return e;try{return Js(e)}catch{return r}}});var Gn=k((eo,Vn)=>{function zn(){this.buffer=[],this.length=0}zn.prototype={get:function(c){let e=Math.floor(c/8);return(this.buffer[e]>>>7-c%8&1)===1},put:function(c,e){for(let r=0;r<e;r++)this.putBit((c>>>e-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(c){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),c&&(this.buffer[e]|=128>>>this.length%8),this.length++}};Vn.exports=zn});var Qn=k((to,Yn)=>{function it(c){if(!c||c<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=c,this.data=new Uint8Array(c*c),this.reservedBit=new Uint8Array(c*c)}it.prototype.set=function(c,e,r,i){let o=c*this.size+e;this.data[o]=r,i&&(this.reservedBit[o]=!0)};it.prototype.get=function(c,e){return this.data[c*this.size+e]};it.prototype.xor=function(c,e,r){this.data[c*this.size+e]^=r};it.prototype.isReserved=function(c,e){return this.reservedBit[c*this.size+e]};Yn.exports=it});var jn=k(kt=>{var Zs=Ee().getSymbolSize;kt.getRowColCoords=function(e){if(e===1)return[];let r=Math.floor(e/7)+2,i=Zs(e),o=i===145?26:Math.ceil((i-13)/(2*r-2))*2,a=[i-7];for(let d=1;d<r-1;d++)a[d]=a[d-1]-o;return a.push(6),a.reverse()};kt.getPositions=function(e){let r=[],i=kt.getRowColCoords(e),o=i.length;for(let a=0;a<o;a++)for(let d=0;d<o;d++)a===0&&d===0||a===0&&d===o-1||a===o-1&&d===0||r.push([i[a],i[d]]);return r}});var Jn=k(Xn=>{var ea=Ee().getSymbolSize,Kn=7;Xn.getPositions=function(e){let r=ea(e);return[[0,0],[r-Kn,0],[0,r-Kn]]}});var Zn=k(q=>{q.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var Le={N1:3,N2:3,N3:40,N4:10};q.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7};q.from=function(e){return q.isValid(e)?parseInt(e,10):void 0};q.getPenaltyN1=function(e){let r=e.size,i=0,o=0,a=0,d=null,h=null;for(let g=0;g<r;g++){o=a=0,d=h=null;for(let S=0;S<r;S++){let _=e.get(g,S);_===d?o++:(o>=5&&(i+=Le.N1+(o-5)),d=_,o=1),_=e.get(S,g),_===h?a++:(a>=5&&(i+=Le.N1+(a-5)),h=_,a=1)}o>=5&&(i+=Le.N1+(o-5)),a>=5&&(i+=Le.N1+(a-5))}return i};q.getPenaltyN2=function(e){let r=e.size,i=0;for(let o=0;o<r-1;o++)for(let a=0;a<r-1;a++){let d=e.get(o,a)+e.get(o,a+1)+e.get(o+1,a)+e.get(o+1,a+1);(d===4||d===0)&&i++}return i*Le.N2};q.getPenaltyN3=function(e){let r=e.size,i=0,o=0,a=0;for(let d=0;d<r;d++){o=a=0;for(let h=0;h<r;h++)o=o<<1&2047|e.get(d,h),h>=10&&(o===1488||o===93)&&i++,a=a<<1&2047|e.get(h,d),h>=10&&(a===1488||a===93)&&i++}return i*Le.N3};q.getPenaltyN4=function(e){let r=0,i=e.data.length;for(let a=0;a<i;a++)r+=e.data[a];return Math.abs(Math.ceil(r*100/i/5)-10)*Le.N4};function ta(c,e,r){switch(c){case q.Patterns.PATTERN000:return(e+r)%2===0;case q.Patterns.PATTERN001:return e%2===0;case q.Patterns.PATTERN010:return r%3===0;case q.Patterns.PATTERN011:return(e+r)%3===0;case q.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(r/3))%2===0;case q.Patterns.PATTERN101:return e*r%2+e*r%3===0;case q.Patterns.PATTERN110:return(e*r%2+e*r%3)%2===0;case q.Patterns.PATTERN111:return(e*r%3+(e+r)%2)%2===0;default:throw new Error("bad maskPattern:"+c)}}q.applyMask=function(e,r){let i=r.size;for(let o=0;o<i;o++)for(let a=0;a<i;a++)r.isReserved(a,o)||r.xor(a,o,ta(e,a,o))};q.getBestMask=function(e,r){let i=Object.keys(q.Patterns).length,o=0,a=1/0;for(let d=0;d<i;d++){r(d),q.applyMask(d,e);let h=q.getPenaltyN1(e)+q.getPenaltyN2(e)+q.getPenaltyN3(e)+q.getPenaltyN4(e);q.applyMask(d,e),h<a&&(a=h,o=d)}return o}});var Nr=k(Cr=>{var ve=Ft(),Mt=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Dt=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Cr.getBlocksCount=function(e,r){switch(r){case ve.L:return Mt[(e-1)*4+0];case ve.M:return Mt[(e-1)*4+1];case ve.Q:return Mt[(e-1)*4+2];case ve.H:return Mt[(e-1)*4+3];default:return}};Cr.getTotalCodewordsCount=function(e,r){switch(r){case ve.L:return Dt[(e-1)*4+0];case ve.M:return Dt[(e-1)*4+1];case ve.Q:return Dt[(e-1)*4+2];case ve.H:return Dt[(e-1)*4+3];default:return}}});var ei=k(qt=>{var st=new Uint8Array(512),Bt=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)st[r]=e,Bt[e]=r,e<<=1,e&256&&(e^=285);for(let r=255;r<512;r++)st[r]=st[r-255]})();qt.log=function(e){if(e<1)throw new Error("log("+e+")");return Bt[e]};qt.exp=function(e){return st[e]};qt.mul=function(e,r){return e===0||r===0?0:st[Bt[e]+Bt[r]]}});var ti=k(at=>{var xr=ei();at.mul=function(e,r){let i=new Uint8Array(e.length+r.length-1);for(let o=0;o<e.length;o++)for(let a=0;a<r.length;a++)i[o+a]^=xr.mul(e[o],r[a]);return i};at.mod=function(e,r){let i=new Uint8Array(e);for(;i.length-r.length>=0;){let o=i[0];for(let d=0;d<r.length;d++)i[d]^=xr.mul(r[d],o);let a=0;for(;a<i.length&&i[a]===0;)a++;i=i.slice(a)}return i};at.generateECPolynomial=function(e){let r=new Uint8Array([1]);for(let i=0;i<e;i++)r=at.mul(r,new Uint8Array([1,xr.exp(i)]));return r}});var ii=k((lo,ni)=>{var ri=ti();function Ir(c){this.genPoly=void 0,this.degree=c,this.degree&&this.initialize(this.degree)}Ir.prototype.initialize=function(e){this.degree=e,this.genPoly=ri.generateECPolynomial(this.degree)};Ir.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");let r=new Uint8Array(e.length+this.degree);r.set(e);let i=ri.mod(r,this.genPoly),o=this.degree-i.length;if(o>0){let a=new Uint8Array(this.degree);return a.set(i,o),a}return i};ni.exports=Ir});var Lr=k(si=>{si.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}});var Pr=k(he=>{var ai="[0-9]+",ra="[A-Z $%*+\\-./:]+",ot="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";ot=ot.replace(/u/g,"\\u");var na="(?:(?![A-Z0-9 $%*+\\-./:]|"+ot+`)(?:.|[\r
]))+`;he.KANJI=new RegExp(ot,"g");he.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");he.BYTE=new RegExp(na,"g");he.NUMERIC=new RegExp(ai,"g");he.ALPHANUMERIC=new RegExp(ra,"g");var ia=new RegExp("^"+ot+"$"),sa=new RegExp("^"+ai+"$"),aa=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");he.testKanji=function(e){return ia.test(e)};he.testNumeric=function(e){return sa.test(e)};he.testAlphanumeric=function(e){return aa.test(e)}});var Se=k(z=>{var oa=Lr(),Fr=Pr();z.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};z.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};z.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};z.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};z.MIXED={bit:-1};z.getCharCountIndicator=function(e,r){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!oa.isValid(r))throw new Error("Invalid version: "+r);return r>=1&&r<10?e.ccBits[0]:r<27?e.ccBits[1]:e.ccBits[2]};z.getBestModeForData=function(e){return Fr.testNumeric(e)?z.NUMERIC:Fr.testAlphanumeric(e)?z.ALPHANUMERIC:Fr.testKanji(e)?z.KANJI:z.BYTE};z.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")};z.isValid=function(e){return e&&e.bit&&e.ccBits};function la(c){if(typeof c!="string")throw new Error("Param is not a string");switch(c.toLowerCase()){case"numeric":return z.NUMERIC;case"alphanumeric":return z.ALPHANUMERIC;case"kanji":return z.KANJI;case"byte":return z.BYTE;default:throw new Error("Unknown mode: "+c)}}z.from=function(e,r){if(z.isValid(e))return e;try{return la(e)}catch{return r}}});var di=k(Pe=>{var Ut=Ee(),ca=Nr(),oi=Ft(),Te=Se(),kr=Lr(),ci=7973,li=Ut.getBCHDigit(ci);function ua(c,e,r){for(let i=1;i<=40;i++)if(e<=Pe.getCapacity(i,r,c))return i}function ui(c,e){return Te.getCharCountIndicator(c,e)+4}function da(c,e){let r=0;return c.forEach(function(i){let o=ui(i.mode,e);r+=o+i.getBitsLength()}),r}function fa(c,e){for(let r=1;r<=40;r++)if(da(c,r)<=Pe.getCapacity(r,e,Te.MIXED))return r}Pe.from=function(e,r){return kr.isValid(e)?parseInt(e,10):r};Pe.getCapacity=function(e,r,i){if(!kr.isValid(e))throw new Error("Invalid QR Code version");typeof i>"u"&&(i=Te.BYTE);let o=Ut.getSymbolTotalCodewords(e),a=ca.getTotalCodewordsCount(e,r),d=(o-a)*8;if(i===Te.MIXED)return d;let h=d-ui(i,e);switch(i){case Te.NUMERIC:return Math.floor(h/10*3);case Te.ALPHANUMERIC:return Math.floor(h/11*2);case Te.KANJI:return Math.floor(h/13);case Te.BYTE:default:return Math.floor(h/8)}};Pe.getBestVersionForData=function(e,r){let i,o=oi.from(r,oi.M);if(Array.isArray(e)){if(e.length>1)return fa(e,o);if(e.length===0)return 1;i=e[0]}else i=e;return ua(i.mode,i.getLength(),o)};Pe.getEncodedBits=function(e){if(!kr.isValid(e)||e<7)throw new Error("Invalid QR Code version");let r=e<<12;for(;Ut.getBCHDigit(r)-li>=0;)r^=ci<<Ut.getBCHDigit(r)-li;return e<<12|r}});var gi=k(pi=>{var Mr=Ee(),hi=1335,ha=21522,fi=Mr.getBCHDigit(hi);pi.getEncodedBits=function(e,r){let i=e.bit<<3|r,o=i<<10;for(;Mr.getBCHDigit(o)-fi>=0;)o^=hi<<Mr.getBCHDigit(o)-fi;return(i<<10|o)^ha}});var bi=k((go,mi)=>{var pa=Se();function We(c){this.mode=pa.NUMERIC,this.data=c.toString()}We.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};We.prototype.getLength=function(){return this.data.length};We.prototype.getBitsLength=function(){return We.getBitsLength(this.data.length)};We.prototype.write=function(e){let r,i,o;for(r=0;r+3<=this.data.length;r+=3)i=this.data.substr(r,3),o=parseInt(i,10),e.put(o,10);let a=this.data.length-r;a>0&&(i=this.data.substr(r),o=parseInt(i,10),e.put(o,a*3+1))};mi.exports=We});var yi=k((mo,wi)=>{var ga=Se(),Dr=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function $e(c){this.mode=ga.ALPHANUMERIC,this.data=c}$e.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};$e.prototype.getLength=function(){return this.data.length};$e.prototype.getBitsLength=function(){return $e.getBitsLength(this.data.length)};$e.prototype.write=function(e){let r;for(r=0;r+2<=this.data.length;r+=2){let i=Dr.indexOf(this.data[r])*45;i+=Dr.indexOf(this.data[r+1]),e.put(i,11)}this.data.length%2&&e.put(Dr.indexOf(this.data[r]),6)};wi.exports=$e});var vi=k((bo,Ei)=>{var ma=Se();function He(c){this.mode=ma.BYTE,typeof c=="string"?this.data=new TextEncoder().encode(c):this.data=new Uint8Array(c)}He.getBitsLength=function(e){return e*8};He.prototype.getLength=function(){return this.data.length};He.prototype.getBitsLength=function(){return He.getBitsLength(this.data.length)};He.prototype.write=function(c){for(let e=0,r=this.data.length;e<r;e++)c.put(this.data[e],8)};Ei.exports=He});var Ti=k((wo,Si)=>{var ba=Se(),wa=Ee();function ze(c){this.mode=ba.KANJI,this.data=c}ze.getBitsLength=function(e){return e*13};ze.prototype.getLength=function(){return this.data.length};ze.prototype.getBitsLength=function(){return ze.getBitsLength(this.data.length)};ze.prototype.write=function(c){let e;for(e=0;e<this.data.length;e++){let r=wa.toSJIS(this.data[e]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),c.put(r,13)}};Si.exports=ze});var Ai=k((yo,Br)=>{"use strict";var lt={single_source_shortest_paths:function(c,e,r){var i={},o={};o[e]=0;var a=lt.PriorityQueue.make();a.push(e,0);for(var d,h,g,S,_,M,L,G,j;!a.empty();){d=a.pop(),h=d.value,S=d.cost,_=c[h]||{};for(g in _)_.hasOwnProperty(g)&&(M=_[g],L=S+M,G=o[g],j=typeof o[g]>"u",(j||G>L)&&(o[g]=L,a.push(g,L),i[g]=h))}if(typeof r<"u"&&typeof o[r]>"u"){var Z=["Could not find a path from ",e," to ",r,"."].join("");throw new Error(Z)}return i},extract_shortest_path_from_predecessor_list:function(c,e){for(var r=[],i=e,o;i;)r.push(i),o=c[i],i=c[i];return r.reverse(),r},find_path:function(c,e,r){var i=lt.single_source_shortest_paths(c,e,r);return lt.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(c){var e=lt.PriorityQueue,r={},i;c=c||{};for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r.queue=[],r.sorter=c.sorter||e.default_sorter,r},default_sorter:function(c,e){return c.cost-e.cost},push:function(c,e){var r={value:c,cost:e};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof Br<"u"&&(Br.exports=lt)});var Pi=k(Ve=>{var P=Se(),Ci=bi(),Ni=yi(),xi=vi(),Ii=Ti(),ct=Pr(),Ot=Ee(),ya=Ai();function _i(c){return unescape(encodeURIComponent(c)).length}function ut(c,e,r){let i=[],o;for(;(o=c.exec(r))!==null;)i.push({data:o[0],index:o.index,mode:e,length:o[0].length});return i}function Li(c){let e=ut(ct.NUMERIC,P.NUMERIC,c),r=ut(ct.ALPHANUMERIC,P.ALPHANUMERIC,c),i,o;return Ot.isKanjiModeEnabled()?(i=ut(ct.BYTE,P.BYTE,c),o=ut(ct.KANJI,P.KANJI,c)):(i=ut(ct.BYTE_KANJI,P.BYTE,c),o=[]),e.concat(r,i,o).sort(function(d,h){return d.index-h.index}).map(function(d){return{data:d.data,mode:d.mode,length:d.length}})}function qr(c,e){switch(e){case P.NUMERIC:return Ci.getBitsLength(c);case P.ALPHANUMERIC:return Ni.getBitsLength(c);case P.KANJI:return Ii.getBitsLength(c);case P.BYTE:return xi.getBitsLength(c)}}function Ea(c){return c.reduce(function(e,r){let i=e.length-1>=0?e[e.length-1]:null;return i&&i.mode===r.mode?(e[e.length-1].data+=r.data,e):(e.push(r),e)},[])}function va(c){let e=[];for(let r=0;r<c.length;r++){let i=c[r];switch(i.mode){case P.NUMERIC:e.push([i,{data:i.data,mode:P.ALPHANUMERIC,length:i.length},{data:i.data,mode:P.BYTE,length:i.length}]);break;case P.ALPHANUMERIC:e.push([i,{data:i.data,mode:P.BYTE,length:i.length}]);break;case P.KANJI:e.push([i,{data:i.data,mode:P.BYTE,length:_i(i.data)}]);break;case P.BYTE:e.push([{data:i.data,mode:P.BYTE,length:_i(i.data)}])}}return e}function Sa(c,e){let r={},i={start:{}},o=["start"];for(let a=0;a<c.length;a++){let d=c[a],h=[];for(let g=0;g<d.length;g++){let S=d[g],_=""+a+g;h.push(_),r[_]={node:S,lastCount:0},i[_]={};for(let M=0;M<o.length;M++){let L=o[M];r[L]&&r[L].node.mode===S.mode?(i[L][_]=qr(r[L].lastCount+S.length,S.mode)-qr(r[L].lastCount,S.mode),r[L].lastCount+=S.length):(r[L]&&(r[L].lastCount=S.length),i[L][_]=qr(S.length,S.mode)+4+P.getCharCountIndicator(S.mode,e))}}o=h}for(let a=0;a<o.length;a++)i[o[a]].end=0;return{map:i,table:r}}function Ri(c,e){let r,i=P.getBestModeForData(c);if(r=P.from(e,i),r!==P.BYTE&&r.bit<i.bit)throw new Error('"'+c+'" cannot be encoded with mode '+P.toString(r)+`.
 Suggested mode is: `+P.toString(i));switch(r===P.KANJI&&!Ot.isKanjiModeEnabled()&&(r=P.BYTE),r){case P.NUMERIC:return new Ci(c);case P.ALPHANUMERIC:return new Ni(c);case P.KANJI:return new Ii(c);case P.BYTE:return new xi(c)}}Ve.fromArray=function(e){return e.reduce(function(r,i){return typeof i=="string"?r.push(Ri(i,null)):i.data&&r.push(Ri(i.data,i.mode)),r},[])};Ve.fromString=function(e,r){let i=Li(e,Ot.isKanjiModeEnabled()),o=va(i),a=Sa(o,r),d=ya.find_path(a.map,"start","end"),h=[];for(let g=1;g<d.length-1;g++)h.push(a.table[d[g]].node);return Ve.fromArray(Ea(h))};Ve.rawSplit=function(e){return Ve.fromArray(Li(e,Ot.isKanjiModeEnabled()))}});var ki=k(Fi=>{var $t=Ee(),Ur=Ft(),Ta=Gn(),Aa=Qn(),_a=jn(),Ra=Jn(),$r=Zn(),Hr=Nr(),Ca=ii(),Wt=di(),Na=gi(),xa=Se(),Or=Pi();function Ia(c,e){let r=c.size,i=Ra.getPositions(e);for(let o=0;o<i.length;o++){let a=i[o][0],d=i[o][1];for(let h=-1;h<=7;h++)if(!(a+h<=-1||r<=a+h))for(let g=-1;g<=7;g++)d+g<=-1||r<=d+g||(h>=0&&h<=6&&(g===0||g===6)||g>=0&&g<=6&&(h===0||h===6)||h>=2&&h<=4&&g>=2&&g<=4?c.set(a+h,d+g,!0,!0):c.set(a+h,d+g,!1,!0))}}function La(c){let e=c.size;for(let r=8;r<e-8;r++){let i=r%2===0;c.set(r,6,i,!0),c.set(6,r,i,!0)}}function Pa(c,e){let r=_a.getPositions(e);for(let i=0;i<r.length;i++){let o=r[i][0],a=r[i][1];for(let d=-2;d<=2;d++)for(let h=-2;h<=2;h++)d===-2||d===2||h===-2||h===2||d===0&&h===0?c.set(o+d,a+h,!0,!0):c.set(o+d,a+h,!1,!0)}}function Fa(c,e){let r=c.size,i=Wt.getEncodedBits(e),o,a,d;for(let h=0;h<18;h++)o=Math.floor(h/3),a=h%3+r-8-3,d=(i>>h&1)===1,c.set(o,a,d,!0),c.set(a,o,d,!0)}function Wr(c,e,r){let i=c.size,o=Na.getEncodedBits(e,r),a,d;for(a=0;a<15;a++)d=(o>>a&1)===1,a<6?c.set(a,8,d,!0):a<8?c.set(a+1,8,d,!0):c.set(i-15+a,8,d,!0),a<8?c.set(8,i-a-1,d,!0):a<9?c.set(8,15-a-1+1,d,!0):c.set(8,15-a-1,d,!0);c.set(i-8,8,1,!0)}function ka(c,e){let r=c.size,i=-1,o=r-1,a=7,d=0;for(let h=r-1;h>0;h-=2)for(h===6&&h--;;){for(let g=0;g<2;g++)if(!c.isReserved(o,h-g)){let S=!1;d<e.length&&(S=(e[d]>>>a&1)===1),c.set(o,h-g,S),a--,a===-1&&(d++,a=7)}if(o+=i,o<0||r<=o){o-=i,i=-i;break}}}function Ma(c,e,r){let i=new Ta;r.forEach(function(g){i.put(g.mode.bit,4),i.put(g.getLength(),xa.getCharCountIndicator(g.mode,c)),g.write(i)});let o=$t.getSymbolTotalCodewords(c),a=Hr.getTotalCodewordsCount(c,e),d=(o-a)*8;for(i.getLengthInBits()+4<=d&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);let h=(d-i.getLengthInBits())/8;for(let g=0;g<h;g++)i.put(g%2?17:236,8);return Da(i,c,e)}function Da(c,e,r){let i=$t.getSymbolTotalCodewords(e),o=Hr.getTotalCodewordsCount(e,r),a=i-o,d=Hr.getBlocksCount(e,r),h=i%d,g=d-h,S=Math.floor(i/d),_=Math.floor(a/d),M=_+1,L=S-_,G=new Ca(L),j=0,Z=new Array(d),je=new Array(d),oe=0,De=new Uint8Array(c.buffer);for(let x=0;x<d;x++){let ce=x<g?_:M;Z[x]=De.slice(j,j+ce),je[x]=G.encode(Z[x]),j+=ce,oe=Math.max(oe,ce)}let ge=new Uint8Array(i),Ae=0,K,D;for(K=0;K<oe;K++)for(D=0;D<d;D++)K<Z[D].length&&(ge[Ae++]=Z[D][K]);for(K=0;K<L;K++)for(D=0;D<d;D++)ge[Ae++]=je[D][K];return ge}function Ba(c,e,r,i){let o;if(Array.isArray(c))o=Or.fromArray(c);else if(typeof c=="string"){let S=e;if(!S){let _=Or.rawSplit(c);S=Wt.getBestVersionForData(_,r)}o=Or.fromString(c,S||40)}else throw new Error("Invalid data");let a=Wt.getBestVersionForData(o,r);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=a;else if(e<a)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+a+`.
`);let d=Ma(e,r,o),h=$t.getSymbolSize(e),g=new Aa(h);return Ia(g,e),La(g),Pa(g,e),Wr(g,r,0),e>=7&&Fa(g,e),ka(g,d),isNaN(i)&&(i=$r.getBestMask(g,Wr.bind(null,g,r))),$r.applyMask(i,g),Wr(g,r,i),{modules:g,version:e,errorCorrectionLevel:r,maskPattern:i,segments:o}}Fi.create=function(e,r){if(typeof e>"u"||e==="")throw new Error("No input text");let i=Ur.M,o,a;return typeof r<"u"&&(i=Ur.from(r.errorCorrectionLevel,Ur.M),o=Wt.from(r.version),a=$r.from(r.maskPattern),r.toSJISFunc&&$t.setToSJISFunction(r.toSJISFunc)),Ba(e,o,i,a)}});var zr=k(Fe=>{function Mi(c){if(typeof c=="number"&&(c=c.toString()),typeof c!="string")throw new Error("Color should be defined as hex string");let e=c.slice().replace("#","").split("");if(e.length<3||e.length===5||e.length>8)throw new Error("Invalid hex color: "+c);(e.length===3||e.length===4)&&(e=Array.prototype.concat.apply([],e.map(function(i){return[i,i]}))),e.length===6&&e.push("F","F");let r=parseInt(e.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+e.slice(0,6).join("")}}Fe.getOptions=function(e){e||(e={}),e.color||(e.color={});let r=typeof e.margin>"u"||e.margin===null||e.margin<0?4:e.margin,i=e.width&&e.width>=21?e.width:void 0,o=e.scale||4;return{width:i,scale:i?4:o,margin:r,color:{dark:Mi(e.color.dark||"#000000ff"),light:Mi(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}};Fe.getScale=function(e,r){return r.width&&r.width>=e+r.margin*2?r.width/(e+r.margin*2):r.scale};Fe.getImageWidth=function(e,r){let i=Fe.getScale(e,r);return Math.floor((e+r.margin*2)*i)};Fe.qrToImageData=function(e,r,i){let o=r.modules.size,a=r.modules.data,d=Fe.getScale(o,i),h=Math.floor((o+i.margin*2)*d),g=i.margin*d,S=[i.color.light,i.color.dark];for(let _=0;_<h;_++)for(let M=0;M<h;M++){let L=(_*h+M)*4,G=i.color.light;if(_>=g&&M>=g&&_<h-g&&M<h-g){let j=Math.floor((_-g)/d),Z=Math.floor((M-g)/d);G=S[a[j*o+Z]?1:0]}e[L++]=G.r,e[L++]=G.g,e[L++]=G.b,e[L]=G.a}}});var Di=k(Ht=>{var Vr=zr();function qa(c,e,r){c.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=r,e.width=r,e.style.height=r+"px",e.style.width=r+"px"}function Ua(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}Ht.render=function(e,r,i){let o=i,a=r;typeof o>"u"&&(!r||!r.getContext)&&(o=r,r=void 0),r||(a=Ua()),o=Vr.getOptions(o);let d=Vr.getImageWidth(e.modules.size,o),h=a.getContext("2d"),g=h.createImageData(d,d);return Vr.qrToImageData(g.data,e,o),qa(h,a,d),h.putImageData(g,0,0),a};Ht.renderToDataURL=function(e,r,i){let o=i;typeof o>"u"&&(!r||!r.getContext)&&(o=r,r=void 0),o||(o={});let a=Ht.render(e,r,o),d=o.type||"image/png",h=o.rendererOpts||{};return a.toDataURL(d,h.quality)}});var Ui=k(qi=>{var Oa=zr();function Bi(c,e){let r=c.a/255,i=e+'="'+c.hex+'"';return r<1?i+" "+e+'-opacity="'+r.toFixed(2).slice(1)+'"':i}function Gr(c,e,r){let i=c+e;return typeof r<"u"&&(i+=" "+r),i}function Wa(c,e,r){let i="",o=0,a=!1,d=0;for(let h=0;h<c.length;h++){let g=Math.floor(h%e),S=Math.floor(h/e);!g&&!a&&(a=!0),c[h]?(d++,h>0&&g>0&&c[h-1]||(i+=a?Gr("M",g+r,.5+S+r):Gr("m",o,0),o=0,a=!1),g+1<e&&c[h+1]||(i+=Gr("h",d),d=0)):o++}return i}qi.render=function(e,r,i){let o=Oa.getOptions(r),a=e.modules.size,d=e.modules.data,h=a+o.margin*2,g=o.color.light.a?"<path "+Bi(o.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",S="<path "+Bi(o.color.dark,"stroke")+' d="'+Wa(d,a,o.margin)+'"/>',_='viewBox="0 0 '+h+" "+h+'"',L='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+_+' shape-rendering="crispEdges">'+g+S+`</svg>
`;return typeof i=="function"&&i(null,L),L}});var Wi=k(dt=>{var $a=Hn(),Yr=ki(),Oi=Di(),Ha=Ui();function Qr(c,e,r,i,o){let a=[].slice.call(arguments,1),d=a.length,h=typeof a[d-1]=="function";if(!h&&!$a())throw new Error("Callback required as last argument");if(h){if(d<2)throw new Error("Too few arguments provided");d===2?(o=r,r=e,e=i=void 0):d===3&&(e.getContext&&typeof o>"u"?(o=i,i=void 0):(o=i,i=r,r=e,e=void 0))}else{if(d<1)throw new Error("Too few arguments provided");return d===1?(r=e,e=i=void 0):d===2&&!e.getContext&&(i=r,r=e,e=void 0),new Promise(function(g,S){try{let _=Yr.create(r,i);g(c(_,e,i))}catch(_){S(_)}})}try{let g=Yr.create(r,i);o(null,c(g,e,i))}catch(g){o(g)}}dt.create=Yr.create;dt.toCanvas=Qr.bind(null,Oi.render);dt.toDataURL=Qr.bind(null,Oi.renderToDataURL);dt.toString=Qr.bind(null,function(c,e,r){return Ha.render(c,r)})});var Hi=k((Qt,Me)=>{var Gt=void 0,Yt=function(c){return Gt||(Gt=new Promise(function(e,r){var i=typeof c<"u"?c:{},o=i.onAbort;i.onAbort=function(t){r(new Error(t)),o&&o(t)},i.postRun=i.postRun||[],i.postRun.push(function(){e(i)}),Me=void 0;var a;a||=typeof i<"u"?i:{};var d=typeof window=="object",h=typeof WorkerGlobalScope<"u",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";a.onRuntimeInitialized=function(){function t(f,w){switch(typeof w){case"boolean":$s(f,w?1:0);break;case"number":Us(f,w);break;case"string":Os(f,w,-1,-1);break;case"object":if(w===null)Dn(f);else if(w.length!=null){var E=Nt(w,Ct);Ws(f,E,w.length,-1),xt(E)}else It(f,"Wrong API use : tried to return a value of an unknown type ("+w+").",-1);break;default:Dn(f)}}function n(f,w){for(var E=[],A=0;A<f;A+=1){var R=ue(w+4*A,"i32"),F=ks(R);if(F===1||F===2)R=qs(R);else if(F===3)R=Ds(R);else if(F===4){F=R,R=Ms(F),F=Bs(F);for(var se=new Uint8Array(R),te=0;te<R;te+=1)se[te]=D[F+te];R=se}else R=null;E.push(R)}return E}function s(f,w){this.Qa=f,this.db=w,this.Oa=1,this.lb=[]}function l(f,w){if(this.db=w,w=Je(f)+1,this.eb=Tr(w),this.eb===null)throw Error("Unable to allocate memory for the SQL string");de(f,x,this.eb,w),this.kb=this.eb,this.Za=this.pb=null}function u(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var w=this.filename,E="/",A=w;if(E&&(E=typeof E=="string"?E:dr(E),A=w?lr(E+"/"+w):E),w=cn(!0,!0),A=us(A,w),f){if(typeof f=="string"){E=Array(f.length);for(var R=0,F=f.length;R<F;++R)E[R]=f.charCodeAt(R);f=E}Tt(A,w|146),E=Oe(A,577),Rn(E,f,0,f.length,0),br(E),Tt(A,w)}}this.handleError(T(this.filename,p)),this.db=ue(p,"i32"),qn(this.db),this.fb={},this.Sa={}}var p=ye(4),b=a.cwrap,T=b("sqlite3_open","number",["string","number"]),I=b("sqlite3_close_v2","number",["number"]),N=b("sqlite3_exec","number",["number","string","number","number","number"]),$=b("sqlite3_changes","number",["number"]),Q=b("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Ln=b("sqlite3_sql","string",["number"]),bs=b("sqlite3_normalized_sql","string",["number"]),Pn=b("sqlite3_prepare_v2","number",["number","number","number","number","number"]),ws=b("sqlite3_bind_text","number",["number","number","number","number","number"]),Fn=b("sqlite3_bind_blob","number",["number","number","number","number","number"]),ys=b("sqlite3_bind_double","number",["number","number","number"]),Es=b("sqlite3_bind_int","number",["number","number","number"]),vs=b("sqlite3_bind_parameter_index","number",["number","string"]),Ss=b("sqlite3_step","number",["number"]),Ts=b("sqlite3_errmsg","string",["number"]),As=b("sqlite3_column_count","number",["number"]),_s=b("sqlite3_data_count","number",["number"]),Rs=b("sqlite3_column_double","number",["number","number"]),kn=b("sqlite3_column_text","string",["number","number"]),Cs=b("sqlite3_column_blob","number",["number","number"]),Ns=b("sqlite3_column_bytes","number",["number","number"]),xs=b("sqlite3_column_type","number",["number","number"]),Is=b("sqlite3_column_name","string",["number","number"]),Ls=b("sqlite3_reset","number",["number"]),Ps=b("sqlite3_clear_bindings","number",["number"]),Fs=b("sqlite3_finalize","number",["number"]),Mn=b("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),ks=b("sqlite3_value_type","number",["number"]),Ms=b("sqlite3_value_bytes","number",["number"]),Ds=b("sqlite3_value_text","string",["number"]),Bs=b("sqlite3_value_blob","number",["number"]),qs=b("sqlite3_value_double","number",["number"]),Us=b("sqlite3_result_double","",["number","number"]),Dn=b("sqlite3_result_null","",["number"]),Os=b("sqlite3_result_text","",["number","string","number","number"]),Ws=b("sqlite3_result_blob","",["number","number","number","number"]),$s=b("sqlite3_result_int","",["number","number"]),It=b("sqlite3_result_error","",["number","string","number"]),Bn=b("sqlite3_aggregate_context","number",["number","number"]),qn=b("RegisterExtensionFunctions","number",["number"]),Un=b("sqlite3_update_hook","number",["number","number","number"]);s.prototype.bind=function(f){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(f)?this.Cb(f):f!=null&&typeof f=="object"?this.Db(f):!0},s.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var f=Ss(this.Qa);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},s.prototype.wb=function(f){return f==null&&(f=this.Oa,this.Oa+=1),Rs(this.Qa,f)},s.prototype.Gb=function(f){if(f==null&&(f=this.Oa,this.Oa+=1),f=kn(this.Qa,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},s.prototype.Hb=function(f){return f==null&&(f=this.Oa,this.Oa+=1),kn(this.Qa,f)},s.prototype.getBlob=function(f){f==null&&(f=this.Oa,this.Oa+=1);var w=Ns(this.Qa,f);f=Cs(this.Qa,f);for(var E=new Uint8Array(w),A=0;A<w;A+=1)E[A]=D[f+A];return E},s.prototype.get=function(f,w){w=w||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var E=_s(this.Qa),A=0;A<E;A+=1)switch(xs(this.Qa,A)){case 1:var R=w.useBigInt?this.Gb(A):this.wb(A);f.push(R);break;case 2:f.push(this.wb(A));break;case 3:f.push(this.Hb(A));break;case 4:f.push(this.getBlob(A));break;default:f.push(null)}return f},s.prototype.getColumnNames=function(){for(var f=[],w=As(this.Qa),E=0;E<w;E+=1)f.push(Is(this.Qa,E));return f},s.prototype.getAsObject=function(f,w){f=this.get(f,w),w=this.getColumnNames();for(var E={},A=0;A<w.length;A+=1)E[w[A]]=f[A];return E},s.prototype.getSQL=function(){return Ln(this.Qa)},s.prototype.getNormalizedSQL=function(){return bs(this.Qa)},s.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},s.prototype.sb=function(f,w){w==null&&(w=this.Oa,this.Oa+=1),f=an(f);var E=Nt(f,Ct);this.lb.push(E),this.db.handleError(ws(this.Qa,w,E,f.length-1,0))},s.prototype.Bb=function(f,w){w==null&&(w=this.Oa,this.Oa+=1);var E=Nt(f,Ct);this.lb.push(E),this.db.handleError(Fn(this.Qa,w,E,f.length,0))},s.prototype.rb=function(f,w){w==null&&(w=this.Oa,this.Oa+=1),this.db.handleError((f===(f|0)?Es:ys)(this.Qa,w,f))},s.prototype.Eb=function(f){f==null&&(f=this.Oa,this.Oa+=1),Fn(this.Qa,f,0,0,0)},s.prototype.tb=function(f,w){switch(w==null&&(w=this.Oa,this.Oa+=1),typeof f){case"string":this.sb(f,w);return;case"number":this.rb(f,w);return;case"bigint":this.sb(f.toString(),w);return;case"boolean":this.rb(f+0,w);return;case"object":if(f===null){this.Eb(w);return}if(f.length!=null){this.Bb(f,w);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},s.prototype.Db=function(f){var w=this;return Object.keys(f).forEach(function(E){var A=vs(w.Qa,E);A!==0&&w.tb(f[E],A)}),!0},s.prototype.Cb=function(f){for(var w=0;w<f.length;w+=1)this.tb(f[w],w+1);return!0},s.prototype.reset=function(){return this.freemem(),Ps(this.Qa)===0&&Ls(this.Qa)===0},s.prototype.freemem=function(){for(var f;(f=this.lb.pop())!==void 0;)xt(f)},s.prototype.free=function(){this.freemem();var f=Fs(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,f},l.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var f=nt(),w=ye(4);Xe(p),Xe(w);try{this.db.handleError(Pn(this.db.db,this.kb,-1,p,w)),this.kb=ue(w,"i32");var E=ue(p,"i32");return E===0?(this.mb(),{done:!0}):(this.Za=new s(E,this.db),this.db.fb[E]=this.Za,{value:this.Za,done:!1})}catch(A){throw this.pb=or(this.kb),this.mb(),A}finally{rt(f)}},l.prototype.mb=function(){xt(this.eb),this.eb=null},l.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:or(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(l.prototype[Symbol.iterator]=function(){return this}),u.prototype.run=function(f,w){if(!this.db)throw"Database closed";if(w){f=this.prepare(f,w);try{f.step()}finally{f.free()}}else this.handleError(N(this.db,f,0,0,p));return this},u.prototype.exec=function(f,w,E){if(!this.db)throw"Database closed";var A=nt(),R=null;try{var F=vr(f),se=ye(4);for(f=[];ue(F,"i8")!==0;){Xe(p),Xe(se),this.handleError(Pn(this.db,F,-1,p,se));var te=ue(p,"i32");if(F=ue(se,"i32"),te!==0){var X=null;for(R=new s(te,this),w!=null&&R.bind(w);R.step();)X===null&&(X={columns:R.getColumnNames(),values:[]},f.push(X)),X.values.push(R.get(null,E));R.free()}}return f}catch(ae){throw R&&R.free(),ae}finally{rt(A)}},u.prototype.each=function(f,w,E,A,R){typeof w=="function"&&(A=E,E=w,w=void 0),f=this.prepare(f,w);try{for(;f.step();)E(f.getAsObject(null,R))}finally{f.free()}if(typeof A=="function")return A()},u.prototype.prepare=function(f,w){if(Xe(p),this.handleError(Q(this.db,f,-1,p,0)),f=ue(p,"i32"),f===0)throw"Nothing to prepare";var E=new s(f,this);return w!=null&&E.bind(w),this.fb[f]=E},u.prototype.iterateStatements=function(f){return new l(f,this)},u.prototype.export=function(){Object.values(this.fb).forEach(function(w){w.free()}),Object.values(this.Sa).forEach(we),this.Sa={},this.handleError(I(this.db));var f=ds(this.filename);return this.handleError(T(this.filename,p)),this.db=ue(p,"i32"),qn(this.db),f},u.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(f){f.free()}),Object.values(this.Sa).forEach(we),this.Sa={},this.Ya&&(we(this.Ya),this.Ya=void 0),this.handleError(I(this.db)),vn("/"+this.filename),this.db=null)},u.prototype.handleError=function(f){if(f===0)return null;throw f=Ts(this.db),Error(f)},u.prototype.getRowsModified=function(){return $(this.db)},u.prototype.create_function=function(f,w){Object.prototype.hasOwnProperty.call(this.Sa,f)&&(we(this.Sa[f]),delete this.Sa[f]);var E=tt(function(A,R,F){R=n(R,F);try{var se=w.apply(null,R)}catch(te){It(A,te,-1);return}t(A,se)},"viii");return this.Sa[f]=E,this.handleError(Mn(this.db,f,w.length,1,0,E,0,0,0)),this},u.prototype.create_aggregate=function(f,w){var E=w.init||function(){return null},A=w.finalize||function(X){return X},R=w.step;if(!R)throw"An aggregate function must have a step function in "+f;var F={};Object.hasOwnProperty.call(this.Sa,f)&&(we(this.Sa[f]),delete this.Sa[f]),w=f+"__finalize",Object.hasOwnProperty.call(this.Sa,w)&&(we(this.Sa[w]),delete this.Sa[w]);var se=tt(function(X,ae,_r){var xe=Bn(X,1);Object.hasOwnProperty.call(F,xe)||(F[xe]=E()),ae=n(ae,_r),ae=[F[xe]].concat(ae);try{F[xe]=R.apply(null,ae)}catch(Hs){delete F[xe],It(X,Hs,-1)}},"viii"),te=tt(function(X){var ae=Bn(X,1);try{var _r=A(F[ae])}catch(xe){delete F[ae],It(X,xe,-1);return}t(X,_r),delete F[ae]},"vi");return this.Sa[f]=se,this.Sa[w]=te,this.handleError(Mn(this.db,f,R.length-1,1,0,0,se,te,0)),this},u.prototype.updateHook=function(f){this.Ya&&(Un(this.db,0,0),we(this.Ya),this.Ya=void 0),f&&(this.Ya=tt(function(w,E,A,R,F){switch(E){case 18:w="insert";break;case 23:w="update";break;case 9:w="delete";break;default:throw"unknown operationCode in updateHook callback: "+E}if(A=A?O(x,A):"",R=R?O(x,R):"",F>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";f(w,A,R,Number(F))},"viiiij"),Un(this.db,this.Ya,0))},a.Database=u};var S={...a},_="./this.program",M=(t,n)=>{throw n},L="",G,j;if(g){var Z=require("fs");require("path"),L=__dirname+"/",j=t=>(t=wt(t)?new URL(t):t,Z.readFileSync(t)),G=async t=>(t=wt(t)?new URL(t):t,Z.readFileSync(t,void 0)),!a.thisProgram&&1<process.argv.length&&(_=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof Me<"u"&&(Me.exports=a),M=(t,n)=>{throw process.exitCode=t,n}}else(d||h)&&(h?L=self.location.href:typeof document<"u"&&document.currentScript&&(L=document.currentScript.src),L=L.startsWith("blob:")?"":L.slice(0,L.replace(/[?#].*/,"").lastIndexOf("/")+1),h&&(j=t=>{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),G=async t=>{if(wt(t))return new Promise((s,l)=>{var u=new XMLHttpRequest;u.open("GET",t,!0),u.responseType="arraybuffer",u.onload=()=>{u.status==200||u.status==0&&u.response?s(u.response):l(u.status)},u.onerror=l,u.send(null)});var n=await fetch(t,{credentials:"same-origin"});if(n.ok)return n.arrayBuffer();throw Error(n.status+" : "+n.url)});var je=a.print||console.log.bind(console),oe=a.printErr||console.error.bind(console);Object.assign(a,S),S=null,a.thisProgram&&(_=a.thisProgram);var De=a.wasmBinary,ge,Ae=!1,K,D,x,ce,B,H,rr,ie,nr,wt=t=>t.startsWith("file://");function Xr(){var t=ge.buffer;a.HEAP8=D=new Int8Array(t),a.HEAP16=ce=new Int16Array(t),a.HEAPU8=x=new Uint8Array(t),a.HEAPU16=new Uint16Array(t),a.HEAP32=B=new Int32Array(t),a.HEAPU32=H=new Uint32Array(t),a.HEAPF32=rr=new Float32Array(t),a.HEAPF64=nr=new Float64Array(t),a.HEAP64=ie=new BigInt64Array(t),a.HEAPU64=new BigUint64Array(t)}var _e=0,Ke=null;function Be(t){throw a.onAbort?.(t),t="Aborted("+t+")",oe(t),Ae=!0,new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info.")}var ir;async function Ki(t){if(!De)try{var n=await G(t);return new Uint8Array(n)}catch{}if(t==ir&&De)t=new Uint8Array(De);else if(j)t=j(t);else throw"both async and sync fetching of the wasm failed";return t}async function Xi(t,n){try{var s=await Ki(t);return await WebAssembly.instantiate(s,n)}catch(l){oe(`failed to asynchronously prepare wasm: ${l}`),Be(l)}}async function Ji(t){var n=ir;if(!De&&typeof WebAssembly.instantiateStreaming=="function"&&!wt(n)&&!g)try{var s=fetch(n,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(s,t)}catch(l){oe(`wasm streaming compile failed: ${l}`),oe("falling back to ArrayBuffer instantiation")}return Xi(n,t)}class sr{name="ExitStatus";constructor(n){this.message=`Program terminated with exit(${n})`,this.status=n}}var Jr=t=>{for(;0<t.length;)t.shift()(a)},Zr=[],en=[],Zi=()=>{var t=a.preRun.shift();en.unshift(t)};function ue(t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return D[t];case"i8":return D[t];case"i16":return ce[t>>1];case"i32":return B[t>>2];case"i64":return ie[t>>3];case"float":return rr[t>>2];case"double":return nr[t>>3];case"*":return H[t>>2];default:Be(`invalid type for getValue: ${n}`)}}var ar=a.noExitRuntime||!0;function Xe(t){var n="i32";switch(n.endsWith("*")&&(n="*"),n){case"i1":D[t]=0;break;case"i8":D[t]=0;break;case"i16":ce[t>>1]=0;break;case"i32":B[t>>2]=0;break;case"i64":ie[t>>3]=BigInt(0);break;case"float":rr[t>>2]=0;break;case"double":nr[t>>3]=0;break;case"*":H[t>>2]=0;break;default:Be(`invalid type for setValue: ${n}`)}}var tn=typeof TextDecoder<"u"?new TextDecoder:void 0,O=(t,n=0,s=NaN)=>{var l=n+s;for(s=n;t[s]&&!(s>=l);)++s;if(16<s-n&&t.buffer&&tn)return tn.decode(t.subarray(n,s));for(l="";n<s;){var u=t[n++];if(u&128){var p=t[n++]&63;if((u&224)==192)l+=String.fromCharCode((u&31)<<6|p);else{var b=t[n++]&63;u=(u&240)==224?(u&15)<<12|p<<6|b:(u&7)<<18|p<<12|b<<6|t[n++]&63,65536>u?l+=String.fromCharCode(u):(u-=65536,l+=String.fromCharCode(55296|u>>10,56320|u&1023))}}else l+=String.fromCharCode(u)}return l},or=(t,n)=>t?O(x,t,n):"",rn=(t,n)=>{for(var s=0,l=t.length-1;0<=l;l--){var u=t[l];u==="."?t.splice(l,1):u===".."?(t.splice(l,1),s++):s&&(t.splice(l,1),s--)}if(n)for(;s;s--)t.unshift("..");return t},lr=t=>{var n=t.charAt(0)==="/",s=t.slice(-1)==="/";return(t=rn(t.split("/").filter(l=>!!l),!n).join("/"))||n||(t="."),t&&s&&(t+="/"),(n?"/":"")+t},nn=t=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=n[0],n=n[1],!t&&!n?".":(n&&=n.slice(0,-1),t+n)},yt=t=>t&&t.match(/([^\/]+|\/)\/*$/)[1],es=()=>{if(g){var t=require("crypto");return n=>t.randomFillSync(n)}return n=>crypto.getRandomValues(n)},sn=t=>{(sn=es())(t)},ts=(...t)=>{for(var n="",s=!1,l=t.length-1;-1<=l&&!s;l--){if(s=0<=l?t[l]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";n=s+"/"+n,s=s.charAt(0)==="/"}return n=rn(n.split("/").filter(u=>!!u),!s).join("/"),(s?"/":"")+n||"."},cr=[],Je=t=>{for(var n=0,s=0;s<t.length;++s){var l=t.charCodeAt(s);127>=l?n++:2047>=l?n+=2:55296<=l&&57343>=l?(n+=4,++s):n+=3}return n},de=(t,n,s,l)=>{if(!(0<l))return 0;var u=s;l=s+l-1;for(var p=0;p<t.length;++p){var b=t.charCodeAt(p);if(55296<=b&&57343>=b){var T=t.charCodeAt(++p);b=65536+((b&1023)<<10)|T&1023}if(127>=b){if(s>=l)break;n[s++]=b}else{if(2047>=b){if(s+1>=l)break;n[s++]=192|b>>6}else{if(65535>=b){if(s+2>=l)break;n[s++]=224|b>>12}else{if(s+3>=l)break;n[s++]=240|b>>18,n[s++]=128|b>>12&63}n[s++]=128|b>>6&63}n[s++]=128|b&63}}return n[s]=0,s-u},an=(t,n)=>{var s=Array(Je(t)+1);return t=de(t,s,0,s.length),n&&(s.length=t),s},on=[];function ln(t,n){on[t]={input:[],output:[],cb:n},gr(t,rs)}var rs={open(t){var n=on[t.node.rdev];if(!n)throw new y(43);t.tty=n,t.seekable=!1},close(t){t.tty.cb.fsync(t.tty)},fsync(t){t.tty.cb.fsync(t.tty)},read(t,n,s,l){if(!t.tty||!t.tty.cb.xb)throw new y(60);for(var u=0,p=0;p<l;p++){try{var b=t.tty.cb.xb(t.tty)}catch{throw new y(29)}if(b===void 0&&u===0)throw new y(6);if(b==null)break;u++,n[s+p]=b}return u&&(t.node.atime=Date.now()),u},write(t,n,s,l){if(!t.tty||!t.tty.cb.qb)throw new y(60);try{for(var u=0;u<l;u++)t.tty.cb.qb(t.tty,n[s+u])}catch{throw new y(29)}return l&&(t.node.mtime=t.node.ctime=Date.now()),u}},ns={xb(){e:{if(!cr.length){var t=null;if(g){var n=Buffer.alloc(256),s=0,l=process.stdin.fd;try{s=Z.readSync(l,n,0,256)}catch(u){if(u.toString().includes("EOF"))s=0;else throw u}0<s&&(t=n.slice(0,s).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(t=window.prompt("Input: "),t!==null&&(t+=`
`));if(!t){t=null;break e}cr=an(t,!0)}t=cr.shift()}return t},qb(t,n){n===null||n===10?(je(O(t.output)),t.output=[]):n!=0&&t.output.push(n)},fsync(t){0<t.output?.length&&(je(O(t.output)),t.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},is={qb(t,n){n===null||n===10?(oe(O(t.output)),t.output=[]):n!=0&&t.output.push(n)},fsync(t){0<t.output?.length&&(oe(O(t.output)),t.output=[])}},C={Wa:null,Xa(){return C.createNode(null,"/",16895,0)},createNode(t,n,s,l){if((s&61440)===24576||(s&61440)===4096)throw new y(63);return C.Wa||(C.Wa={dir:{node:{Ta:C.La.Ta,Ua:C.La.Ua,lookup:C.La.lookup,hb:C.La.hb,rename:C.La.rename,unlink:C.La.unlink,rmdir:C.La.rmdir,readdir:C.La.readdir,symlink:C.La.symlink},stream:{Va:C.Ma.Va}},file:{node:{Ta:C.La.Ta,Ua:C.La.Ua},stream:{Va:C.Ma.Va,read:C.Ma.read,write:C.Ma.write,ib:C.Ma.ib,jb:C.Ma.jb}},link:{node:{Ta:C.La.Ta,Ua:C.La.Ua,readlink:C.La.readlink},stream:{}},ub:{node:{Ta:C.La.Ta,Ua:C.La.Ua},stream:cs}}),s=pn(t,n,s,l),Y(s.mode)?(s.La=C.Wa.dir.node,s.Ma=C.Wa.dir.stream,s.Na={}):(s.mode&61440)===32768?(s.La=C.Wa.file.node,s.Ma=C.Wa.file.stream,s.Ra=0,s.Na=null):(s.mode&61440)===40960?(s.La=C.Wa.link.node,s.Ma=C.Wa.link.stream):(s.mode&61440)===8192&&(s.La=C.Wa.ub.node,s.Ma=C.Wa.ub.stream),s.atime=s.mtime=s.ctime=Date.now(),t&&(t.Na[n]=s,t.atime=t.mtime=t.ctime=s.atime),s},Sb(t){return t.Na?t.Na.subarray?t.Na.subarray(0,t.Ra):new Uint8Array(t.Na):new Uint8Array(0)},La:{Ta(t){var n={};return n.dev=(t.mode&61440)===8192?t.id:1,n.ino=t.id,n.mode=t.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=t.rdev,Y(t.mode)?n.size=4096:(t.mode&61440)===32768?n.size=t.Ra:(t.mode&61440)===40960?n.size=t.link.length:n.size=0,n.atime=new Date(t.atime),n.mtime=new Date(t.mtime),n.ctime=new Date(t.ctime),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},Ua(t,n){for(var s of["mode","atime","mtime","ctime"])n[s]!=null&&(t[s]=n[s]);n.size!==void 0&&(n=n.size,t.Ra!=n&&(n==0?(t.Na=null,t.Ra=0):(s=t.Na,t.Na=new Uint8Array(n),s&&t.Na.set(s.subarray(0,Math.min(n,t.Ra))),t.Ra=n)))},lookup(){throw C.vb},hb(t,n,s,l){return C.createNode(t,n,s,l)},rename(t,n,s){try{var l=Re(n,s)}catch{}if(l){if(Y(t.mode))for(var u in l.Na)throw new y(55);hr(l)}delete t.parent.Na[t.name],n.Na[s]=t,t.name=s,n.ctime=n.mtime=t.parent.ctime=t.parent.mtime=Date.now()},unlink(t,n){delete t.Na[n],t.ctime=t.mtime=Date.now()},rmdir(t,n){var s=Re(t,n),l;for(l in s.Na)throw new y(55);delete t.Na[n],t.ctime=t.mtime=Date.now()},readdir(t){return[".","..",...Object.keys(t.Na)]},symlink(t,n,s){return t=C.createNode(t,n,41471,0),t.link=s,t},readlink(t){if((t.mode&61440)!==40960)throw new y(28);return t.link}},Ma:{read(t,n,s,l,u){var p=t.node.Na;if(u>=t.node.Ra)return 0;if(t=Math.min(t.node.Ra-u,l),8<t&&p.subarray)n.set(p.subarray(u,u+t),s);else for(l=0;l<t;l++)n[s+l]=p[u+l];return t},write(t,n,s,l,u,p){if(n.buffer===D.buffer&&(p=!1),!l)return 0;if(t=t.node,t.mtime=t.ctime=Date.now(),n.subarray&&(!t.Na||t.Na.subarray)){if(p)return t.Na=n.subarray(s,s+l),t.Ra=l;if(t.Ra===0&&u===0)return t.Na=n.slice(s,s+l),t.Ra=l;if(u+l<=t.Ra)return t.Na.set(n.subarray(s,s+l),u),l}p=u+l;var b=t.Na?t.Na.length:0;if(b>=p||(p=Math.max(p,b*(1048576>b?2:1.125)>>>0),b!=0&&(p=Math.max(p,256)),b=t.Na,t.Na=new Uint8Array(p),0<t.Ra&&t.Na.set(b.subarray(0,t.Ra),0)),t.Na.subarray&&n.subarray)t.Na.set(n.subarray(s,s+l),u);else for(p=0;p<l;p++)t.Na[u+p]=n[s+p];return t.Ra=Math.max(t.Ra,u+l),l},Va(t,n,s){if(s===1?n+=t.position:s===2&&(t.node.mode&61440)===32768&&(n+=t.node.Ra),0>n)throw new y(28);return n},ib(t,n,s,l,u){if((t.node.mode&61440)!==32768)throw new y(43);if(t=t.node.Na,u&2||!t||t.buffer!==D.buffer){u=!0,l=65536*Math.ceil(n/65536);var p=xn(65536,l);if(p&&x.fill(0,p,p+l),l=p,!l)throw new y(48);t&&((0<s||s+n<t.length)&&(t.subarray?t=t.subarray(s,s+n):t=Array.prototype.slice.call(t,s,s+n)),D.set(t,l))}else u=!1,l=t.byteOffset;return{Kb:l,Ab:u}},jb(t,n,s,l){return C.Ma.write(t,n,0,l,s,!1),0}}},cn=(t,n)=>{var s=0;return t&&(s|=365),n&&(s|=146),s},ur=null,un={},qe=[],ss=1,me=null,dn=!1,fn=!0,hn={},y=class{name="ErrnoError";constructor(t){this.Pa=t}},as=class{gb={};node=null;get flags(){return this.gb.flags}set flags(t){this.gb.flags=t}get position(){return this.gb.position}set position(t){this.gb.position=t}},os=class{La={};Ma={};ab=null;constructor(t,n,s,l){t||=this,this.parent=t,this.Xa=t.Xa,this.id=ss++,this.name=n,this.mode=s,this.rdev=l,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(t){t?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(t){t?this.mode|=146:this.mode&=-147}};function ee(t,n={}){if(!t)throw new y(44);n.nb??(n.nb=!0),t.charAt(0)==="/"||(t="//"+t);var s=0;e:for(;40>s;s++){t=t.split("/").filter(T=>!!T);for(var l=ur,u="/",p=0;p<t.length;p++){var b=p===t.length-1;if(b&&n.parent)break;if(t[p]!==".")if(t[p]==="..")u=nn(u),l=l.parent;else{u=lr(u+"/"+t[p]);try{l=Re(l,t[p])}catch(T){if(T?.Pa===44&&b&&n.Jb)return{path:u};throw T}if(!l.ab||b&&!n.nb||(l=l.ab.root),(l.mode&61440)===40960&&(!b||n.$a)){if(!l.La.readlink)throw new y(52);l=l.La.readlink(l),l.charAt(0)==="/"||(l=nn(u)+"/"+l),t=l+"/"+t.slice(p+1).join("/");continue e}}}return{path:u,node:l}}throw new y(32)}function dr(t){for(var n;;){if(t===t.parent)return t=t.Xa.zb,n?t[t.length-1]!=="/"?`${t}/${n}`:t+n:t;n=n?`${t.name}/${n}`:t.name,t=t.parent}}function fr(t,n){for(var s=0,l=0;l<n.length;l++)s=(s<<5)-s+n.charCodeAt(l)|0;return(t+s>>>0)%me.length}function hr(t){var n=fr(t.parent.id,t.name);if(me[n]===t)me[n]=t.bb;else for(n=me[n];n;){if(n.bb===t){n.bb=t.bb;break}n=n.bb}}function Re(t,n){var s=Y(t.mode)?(s=Ue(t,"x"))?s:t.La.lookup?0:2:54;if(s)throw new y(s);for(s=me[fr(t.id,n)];s;s=s.bb){var l=s.name;if(s.parent.id===t.id&&l===n)return s}return t.La.lookup(t,n)}function pn(t,n,s,l){return t=new os(t,n,s,l),n=fr(t.parent.id,t.name),t.bb=me[n],me[n]=t}function Y(t){return(t&61440)===16384}function gn(t){var n=["r","w","rw"][t&3];return t&512&&(n+="w"),n}function Ue(t,n){if(fn)return 0;if(!n.includes("r")||t.mode&292){if(n.includes("w")&&!(t.mode&146)||n.includes("x")&&!(t.mode&73))return 2}else return 2;return 0}function mn(t,n){if(!Y(t.mode))return 54;try{return Re(t,n),20}catch{}return Ue(t,"wx")}function bn(t,n,s){try{var l=Re(t,n)}catch(u){return u.Pa}if(t=Ue(t,"wx"))return t;if(s){if(!Y(l.mode))return 54;if(l===l.parent||dr(l)==="/")return 10}else if(Y(l.mode))return 31;return 0}function Et(t){if(!t)throw new y(63);return t}function V(t){if(t=qe[t],!t)throw new y(8);return t}function wn(t,n=-1){if(t=Object.assign(new as,t),n==-1)e:{for(n=0;4096>=n;n++)if(!qe[n])break e;throw new y(33)}return t.fd=n,qe[n]=t}function ls(t,n=-1){return t=wn(t,n),t.Ma?.Rb?.(t),t}function pr(t,n,s){var l=t?.Ma.Ua;t=l?t:n,l??=n.La.Ua,Et(l),l(t,s)}var cs={open(t){t.Ma=un[t.node.rdev].Ma,t.Ma.open?.(t)},Va(){throw new y(70)}};function gr(t,n){un[t]={Ma:n}}function yn(t,n){var s=n==="/";if(s&&ur)throw new y(10);if(!s&&n){var l=ee(n,{nb:!1});if(n=l.path,l=l.node,l.ab)throw new y(10);if(!Y(l.mode))throw new y(54)}n={type:t,Wb:{},zb:n,Ib:[]},t=t.Xa(n),t.Xa=n,n.root=t,s?ur=t:l&&(l.ab=n,l.Xa&&l.Xa.Ib.push(n))}function vt(t,n,s){var l=ee(t,{parent:!0}).node;if(t=yt(t),!t)throw new y(28);if(t==="."||t==="..")throw new y(20);var u=mn(l,t);if(u)throw new y(u);if(!l.La.hb)throw new y(63);return l.La.hb(l,t,n,s)}function us(t,n=438){return vt(t,n&4095|32768,0)}function le(t,n=511){return vt(t,n&1023|16384,0)}function St(t,n,s){typeof s>"u"&&(s=n,n=438),vt(t,n|8192,s)}function mr(t,n){if(!ts(t))throw new y(44);var s=ee(n,{parent:!0}).node;if(!s)throw new y(44);n=yt(n);var l=mn(s,n);if(l)throw new y(l);if(!s.La.symlink)throw new y(63);s.La.symlink(s,n,t)}function En(t){var n=ee(t,{parent:!0}).node;t=yt(t);var s=Re(n,t),l=bn(n,t,!0);if(l)throw new y(l);if(!n.La.rmdir)throw new y(63);if(s.ab)throw new y(10);n.La.rmdir(n,t),hr(s)}function vn(t){var n=ee(t,{parent:!0}).node;if(!n)throw new y(44);t=yt(t);var s=Re(n,t),l=bn(n,t,!1);if(l)throw new y(l);if(!n.La.unlink)throw new y(63);if(s.ab)throw new y(10);n.La.unlink(n,t),hr(s)}function Ze(t,n){return t=ee(t,{$a:!n}).node,Et(t.La.Ta)(t)}function Sn(t,n,s,l){pr(t,n,{mode:s&4095|n.mode&-4096,ctime:Date.now(),Fb:l})}function Tt(t,n){t=typeof t=="string"?ee(t,{$a:!0}).node:t,Sn(null,t,n)}function Tn(t,n,s){if(Y(n.mode))throw new y(31);if((n.mode&61440)!==32768)throw new y(28);var l=Ue(n,"w");if(l)throw new y(l);pr(t,n,{size:s,timestamp:Date.now()})}function Oe(t,n,s=438){if(t==="")throw new y(44);if(typeof n=="string"){var l={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[n];if(typeof l>"u")throw Error(`Unknown file open mode: ${n}`);n=l}if(s=n&64?s&4095|32768:0,typeof t=="object")l=t;else{var u=t.endsWith("/");t=ee(t,{$a:!(n&131072),Jb:!0}),l=t.node,t=t.path}var p=!1;if(n&64)if(l){if(n&128)throw new y(20)}else{if(u)throw new y(31);l=vt(t,s|511,0),p=!0}if(!l)throw new y(44);if((l.mode&61440)===8192&&(n&=-513),n&65536&&!Y(l.mode))throw new y(54);if(!p&&(u=l?(l.mode&61440)===40960?32:Y(l.mode)&&(gn(n)!=="r"||n&576)?31:Ue(l,gn(n)):44))throw new y(u);return n&512&&!p&&(u=l,u=typeof u=="string"?ee(u,{$a:!0}).node:u,Tn(null,u,0)),n&=-131713,u=wn({node:l,path:dr(l),flags:n,seekable:!0,position:0,Ma:l.Ma,Lb:[],error:!1}),u.Ma.open&&u.Ma.open(u),p&&Tt(l,s&511),!a.logReadFiles||n&1||t in hn||(hn[t]=1),u}function br(t){if(t.fd===null)throw new y(8);t.ob&&(t.ob=null);try{t.Ma.close&&t.Ma.close(t)}catch(n){throw n}finally{qe[t.fd]=null}t.fd=null}function An(t,n,s){if(t.fd===null)throw new y(8);if(!t.seekable||!t.Ma.Va)throw new y(70);if(s!=0&&s!=1&&s!=2)throw new y(28);t.position=t.Ma.Va(t,n,s),t.Lb=[]}function _n(t,n,s,l,u){if(0>l||0>u)throw new y(28);if(t.fd===null)throw new y(8);if((t.flags&2097155)===1)throw new y(8);if(Y(t.node.mode))throw new y(31);if(!t.Ma.read)throw new y(28);var p=typeof u<"u";if(!p)u=t.position;else if(!t.seekable)throw new y(70);return n=t.Ma.read(t,n,s,l,u),p||(t.position+=n),n}function Rn(t,n,s,l,u){if(0>l||0>u)throw new y(28);if(t.fd===null)throw new y(8);if(!(t.flags&2097155))throw new y(8);if(Y(t.node.mode))throw new y(31);if(!t.Ma.write)throw new y(28);t.seekable&&t.flags&1024&&An(t,0,2);var p=typeof u<"u";if(!p)u=t.position;else if(!t.seekable)throw new y(70);return n=t.Ma.write(t,n,s,l,u,void 0),p||(t.position+=n),n}function ds(t){var n="binary";if(n!=="utf8"&&n!=="binary")throw Error(`Invalid encoding type "${n}"`);var s,l=Oe(t,l||0);t=Ze(t).size;var u=new Uint8Array(t);return _n(l,u,0,t,0),n==="utf8"?s=O(u):n==="binary"&&(s=u),br(l),s}function be(t,n,s){t=lr("/dev/"+t);var l=cn(!!n,!!s);be.yb??(be.yb=64);var u=be.yb++<<8|0;gr(u,{open(p){p.seekable=!1},close(){s?.buffer?.length&&s(10)},read(p,b,T,I){for(var N=0,$=0;$<I;$++){try{var Q=n()}catch{throw new y(29)}if(Q===void 0&&N===0)throw new y(6);if(Q==null)break;N++,b[T+$]=Q}return N&&(p.node.atime=Date.now()),N},write(p,b,T,I){for(var N=0;N<I;N++)try{s(b[T+N])}catch{throw new y(29)}return I&&(p.node.mtime=p.node.ctime=Date.now()),N}}),St(t,l,u)}var U={};function Ce(t,n,s){if(n.charAt(0)==="/")return n;if(t=t===-100?"/":V(t).path,n.length==0){if(!s)throw new y(44);return t}return t+"/"+n}function At(t,n){B[t>>2]=n.dev,B[t+4>>2]=n.mode,H[t+8>>2]=n.nlink,B[t+12>>2]=n.uid,B[t+16>>2]=n.gid,B[t+20>>2]=n.rdev,ie[t+24>>3]=BigInt(n.size),B[t+32>>2]=4096,B[t+36>>2]=n.blocks;var s=n.atime.getTime(),l=n.mtime.getTime(),u=n.ctime.getTime();return ie[t+40>>3]=BigInt(Math.floor(s/1e3)),H[t+48>>2]=s%1e3*1e6,ie[t+56>>3]=BigInt(Math.floor(l/1e3)),H[t+64>>2]=l%1e3*1e6,ie[t+72>>3]=BigInt(Math.floor(u/1e3)),H[t+80>>2]=u%1e3*1e6,ie[t+88>>3]=BigInt(n.ino),0}var _t=void 0,Rt=()=>{var t=B[+_t>>2];return _t+=4,t},wr=0,fs=[0,31,60,91,121,152,182,213,244,274,305,335],hs=[0,31,59,90,120,151,181,212,243,273,304,334],et={},Cn=t=>{K=t,ar||0<wr||(a.onExit?.(t),Ae=!0),M(t,new sr(t))},ps=t=>{if(!Ae)try{if(t(),!(ar||0<wr))try{K=t=K,Cn(t)}catch(n){n instanceof sr||n=="unwind"||M(1,n)}}catch(n){n instanceof sr||n=="unwind"||M(1,n)}},yr={},Nn=()=>{if(!Er){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:_||"./this.program"},n;for(n in yr)yr[n]===void 0?delete t[n]:t[n]=yr[n];var s=[];for(n in t)s.push(`${n}=${t[n]}`);Er=s}return Er},Er,vr=t=>{var n=Je(t)+1,s=ye(n);return de(t,x,s,n),s},gs=(t,n,s,l)=>{var u={string:N=>{var $=0;return N!=null&&N!==0&&($=vr(N)),$},array:N=>{var $=ye(N.length);return D.set(N,$),$}};t=a["_"+t];var p=[],b=0;if(l)for(var T=0;T<l.length;T++){var I=u[s[T]];I?(b===0&&(b=nt()),p[T]=I(l[T])):p[T]=l[T]}return s=t(...p),s=function(N){return b!==0&&rt(b),n==="string"?N?O(x,N):"":n==="boolean"?!!N:N}(s)},Ct=0,Nt=(t,n)=>(n=n==1?ye(t.length):Tr(t.length),t.subarray||t.slice||(t=new Uint8Array(t)),x.set(t,n),n),Ne,Sr=[],fe,we=t=>{Ne.delete(fe.get(t)),fe.set(t,null),Sr.push(t)},tt=(t,n)=>{if(!Ne){Ne=new WeakMap;var s=fe.length;if(Ne)for(var l=0;l<0+s;l++){var u=fe.get(l);u&&Ne.set(u,l)}}if(s=Ne.get(t)||0)return s;if(Sr.length)s=Sr.pop();else{try{fe.grow(1)}catch(I){throw I instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":I}s=fe.length-1}try{fe.set(s,t)}catch(I){if(!(I instanceof TypeError))throw I;if(typeof WebAssembly.Function=="function"){var p=WebAssembly.Function;l={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},u={parameters:[],results:n[0]=="v"?[]:[l[n[0]]]};for(var b=1;b<n.length;++b)u.parameters.push(l[n[b]]);n=new p(u,t)}else{l=[1],u=n.slice(0,1),n=n.slice(1),b={i:127,p:127,j:126,f:125,d:124,e:111},l.push(96);var T=n.length;128>T?l.push(T):l.push(T%128|128,T>>7);for(p of n)l.push(b[p]);u=="v"?l.push(0):l.push(1,b[u]),n=[0,97,115,109,1,0,0,0,1],p=l.length,128>p?n.push(p):n.push(p%128|128,p>>7),n.push(...l),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),n=new WebAssembly.Module(new Uint8Array(n)),n=new WebAssembly.Instance(n,{e:{f:t}}).exports.f}fe.set(s,n)}return Ne.set(t,s),s};me=Array(4096),yn(C,"/"),le("/tmp"),le("/home"),le("/home/web_user"),function(){le("/dev"),gr(259,{read:()=>0,write:(l,u,p,b)=>b,Va:()=>0}),St("/dev/null",259),ln(1280,ns),ln(1536,is),St("/dev/tty",1280),St("/dev/tty1",1536);var t=new Uint8Array(1024),n=0,s=()=>(n===0&&(sn(t),n=t.byteLength),t[--n]);be("random",s),be("urandom",s),le("/dev/shm"),le("/dev/shm/tmp")}(),function(){le("/proc");var t=le("/proc/self");le("/proc/self/fd"),yn({Xa(){var n=pn(t,"fd",16895,73);return n.Ma={Va:C.Ma.Va},n.La={lookup(s,l){s=+l;var u=V(s);return s={parent:null,Xa:{zb:"fake"},La:{readlink:()=>u.path},id:s+1},s.parent=s},readdir(){return Array.from(qe.entries()).filter(([,s])=>s).map(([s])=>s.toString())}},n}},"/proc/self/fd")}(),C.vb=new y(44),C.vb.stack="<generic error, no stack>";var ms={a:(t,n,s,l)=>Be(`Assertion failed: ${t?O(x,t):""}, at: `+[n?n?O(x,n):"":"unknown filename",s,l?l?O(x,l):"":"unknown function"]),i:function(t,n){try{return t=t?O(x,t):"",Tt(t,n),0}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return-s.Pa}},L:function(t,n,s){try{if(n=n?O(x,n):"",n=Ce(t,n),s&-8)return-28;var l=ee(n,{$a:!0}).node;return l?(t="",s&4&&(t+="r"),s&2&&(t+="w"),s&1&&(t+="x"),t&&Ue(l,t)?-2:0):-44}catch(u){if(typeof U>"u"||u.name!=="ErrnoError")throw u;return-u.Pa}},j:function(t,n){try{var s=V(t);return Sn(s,s.node,n,!1),0}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},h:function(t){try{var n=V(t);return pr(n,n.node,{timestamp:Date.now(),Fb:!1}),0}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return-s.Pa}},b:function(t,n,s){_t=s;try{var l=V(t);switch(n){case 0:var u=Rt();if(0>u)break;for(;qe[u];)u++;return ls(l,u).fd;case 1:case 2:return 0;case 3:return l.flags;case 4:return u=Rt(),l.flags|=u,0;case 12:return u=Rt(),ce[u+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(p){if(typeof U>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},g:function(t,n){try{var s=V(t),l=s.node,u=s.Ma.Ta;t=u?s:l,u??=l.La.Ta,Et(u);var p=u(t);return At(n,p)}catch(b){if(typeof U>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},H:function(t,n){n=-9007199254740992>n||9007199254740992<n?NaN:Number(n);try{if(isNaN(n))return 61;var s=V(t);if(0>n||!(s.flags&2097155))throw new y(28);return Tn(s,s.node,n),0}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},G:function(t,n){try{if(n===0)return-28;var s=Je("/")+1;return n<s?-68:(de("/",x,t,n),s)}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},K:function(t,n){try{return t=t?O(x,t):"",At(n,Ze(t,!0))}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return-s.Pa}},C:function(t,n,s){try{return n=n?O(x,n):"",n=Ce(t,n),le(n,s),0}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},J:function(t,n,s,l){try{n=n?O(x,n):"";var u=l&256;return n=Ce(t,n,l&4096),At(s,u?Ze(n,!0):Ze(n))}catch(p){if(typeof U>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},x:function(t,n,s,l){_t=l;try{n=n?O(x,n):"",n=Ce(t,n);var u=l?Rt():0;return Oe(n,s,u).fd}catch(p){if(typeof U>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},v:function(t,n,s,l){try{if(n=n?O(x,n):"",n=Ce(t,n),0>=l)return-28;var u=ee(n).node;if(!u)throw new y(44);if(!u.La.readlink)throw new y(28);var p=u.La.readlink(u),b=Math.min(l,Je(p)),T=D[s+b];return de(p,x,s,l+1),D[s+b]=T,b}catch(I){if(typeof U>"u"||I.name!=="ErrnoError")throw I;return-I.Pa}},u:function(t){try{return t=t?O(x,t):"",En(t),0}catch(n){if(typeof U>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},f:function(t,n){try{return t=t?O(x,t):"",At(n,Ze(t))}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return-s.Pa}},r:function(t,n,s){try{return n=n?O(x,n):"",n=Ce(t,n),s===0?vn(n):s===512?En(n):Be("Invalid flags passed to unlinkat"),0}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},q:function(t,n,s){try{n=n?O(x,n):"",n=Ce(t,n,!0);var l=Date.now(),u,p;if(s){var b=H[s>>2]+4294967296*B[s+4>>2],T=B[s+8>>2];T==1073741823?u=l:T==1073741822?u=null:u=1e3*b+T/1e6,s+=16,b=H[s>>2]+4294967296*B[s+4>>2],T=B[s+8>>2],T==1073741823?p=l:T==1073741822?p=null:p=1e3*b+T/1e6}else p=u=l;if((p??u)!==null){t=u;var I=ee(n,{$a:!0}).node;Et(I.La.Ua)(I,{atime:t,mtime:p})}return 0}catch(N){if(typeof U>"u"||N.name!=="ErrnoError")throw N;return-N.Pa}},m:()=>Be(""),l:()=>{ar=!1,wr=0},A:function(t,n){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),t=new Date(1e3*t),B[n>>2]=t.getSeconds(),B[n+4>>2]=t.getMinutes(),B[n+8>>2]=t.getHours(),B[n+12>>2]=t.getDate(),B[n+16>>2]=t.getMonth(),B[n+20>>2]=t.getFullYear()-1900,B[n+24>>2]=t.getDay();var s=t.getFullYear();B[n+28>>2]=(s%4!==0||s%100===0&&s%400!==0?hs:fs)[t.getMonth()]+t.getDate()-1|0,B[n+36>>2]=-(60*t.getTimezoneOffset()),s=new Date(t.getFullYear(),6,1).getTimezoneOffset();var l=new Date(t.getFullYear(),0,1).getTimezoneOffset();B[n+32>>2]=(s!=l&&t.getTimezoneOffset()==Math.min(l,s))|0},y:function(t,n,s,l,u,p,b){u=-9007199254740992>u||9007199254740992<u?NaN:Number(u);try{if(isNaN(u))return 61;var T=V(l);if(n&2&&!(s&2)&&(T.flags&2097155)!==2)throw new y(2);if((T.flags&2097155)===1)throw new y(2);if(!T.Ma.ib)throw new y(43);if(!t)throw new y(28);var I=T.Ma.ib(T,t,u,n,s),N=I.Kb;return B[p>>2]=I.Ab,H[b>>2]=N,0}catch($){if(typeof U>"u"||$.name!=="ErrnoError")throw $;return-$.Pa}},z:function(t,n,s,l,u,p){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p);try{var b=V(u);if(s&2){if(s=p,(b.node.mode&61440)!==32768)throw new y(43);if(!(l&2)){var T=x.slice(t,t+n);b.Ma.jb&&b.Ma.jb(b,T,s,n,l)}}}catch(I){if(typeof U>"u"||I.name!=="ErrnoError")throw I;return-I.Pa}},n:(t,n)=>{if(et[t]&&(clearTimeout(et[t].id),delete et[t]),!n)return 0;var s=setTimeout(()=>{delete et[t],ps(()=>In(t,performance.now()))},n);return et[t]={id:s,Xb:n},0},B:(t,n,s,l)=>{var u=new Date().getFullYear(),p=new Date(u,0,1).getTimezoneOffset();u=new Date(u,6,1).getTimezoneOffset(),H[t>>2]=60*Math.max(p,u),B[n>>2]=+(p!=u),n=b=>{var T=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(T/60)).padStart(2,"0")}${String(T%60).padStart(2,"0")}`},t=n(p),n=n(u),u<p?(de(t,x,s,17),de(n,x,l,17)):(de(t,x,l,17),de(n,x,s,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:t=>{var n=x.length;if(t>>>=0,2147483648<t)return!1;for(var s=1;4>=s;s*=2){var l=n*(1+.2/s);l=Math.min(l,t+100663296);e:{l=(Math.min(2147483648,65536*Math.ceil(Math.max(t,l)/65536))-ge.buffer.byteLength+65535)/65536|0;try{ge.grow(l),Xr();var u=1;break e}catch{}u=void 0}if(u)return!0}return!1},E:(t,n)=>{var s=0;return Nn().forEach((l,u)=>{var p=n+s;for(u=H[t+4*u>>2]=p,p=0;p<l.length;++p)D[u++]=l.charCodeAt(p);D[u]=0,s+=l.length+1}),0},F:(t,n)=>{var s=Nn();H[t>>2]=s.length;var l=0;return s.forEach(u=>l+=u.length+1),H[n>>2]=l,0},e:function(t){try{var n=V(t);return br(n),0}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return s.Pa}},p:function(t,n){try{var s=V(t);return D[n]=s.tty?2:Y(s.mode)?3:(s.mode&61440)===40960?7:4,ce[n+2>>1]=0,ie[n+8>>3]=BigInt(0),ie[n+16>>3]=BigInt(0),0}catch(l){if(typeof U>"u"||l.name!=="ErrnoError")throw l;return l.Pa}},w:function(t,n,s,l){try{e:{var u=V(t);t=n;for(var p,b=n=0;b<s;b++){var T=H[t>>2],I=H[t+4>>2];t+=8;var N=_n(u,D,T,I,p);if(0>N){var $=-1;break e}if(n+=N,N<I)break;typeof p<"u"&&(p+=N)}$=n}return H[l>>2]=$,0}catch(Q){if(typeof U>"u"||Q.name!=="ErrnoError")throw Q;return Q.Pa}},D:function(t,n,s,l){n=-9007199254740992>n||9007199254740992<n?NaN:Number(n);try{if(isNaN(n))return 61;var u=V(t);return An(u,n,s),ie[l>>3]=BigInt(u.position),u.ob&&n===0&&s===0&&(u.ob=null),0}catch(p){if(typeof U>"u"||p.name!=="ErrnoError")throw p;return p.Pa}},I:function(t){try{var n=V(t);return n.Ma?.fsync?n.Ma.fsync(n):0}catch(s){if(typeof U>"u"||s.name!=="ErrnoError")throw s;return s.Pa}},t:function(t,n,s,l){try{e:{var u=V(t);t=n;for(var p,b=n=0;b<s;b++){var T=H[t>>2],I=H[t+4>>2];t+=8;var N=Rn(u,D,T,I,p);if(0>N){var $=-1;break e}if(n+=N,N<I)break;typeof p<"u"&&(p+=N)}$=n}return H[l>>2]=$,0}catch(Q){if(typeof U>"u"||Q.name!=="ErrnoError")throw Q;return Q.Pa}},k:Cn},v;(async function(){function t(s){return v=s.exports,ge=v.M,Xr(),fe=v.O,_e--,a.monitorRunDependencies?.(_e),_e==0&&Ke&&(s=Ke,Ke=null,s()),v}_e++,a.monitorRunDependencies?.(_e);var n={a:ms};return a.instantiateWasm?new Promise(s=>{a.instantiateWasm(n,(l,u)=>{t(l,u),s(l.exports)})}):(ir??=a.locateFile?a.locateFile("sql-wasm.wasm",L):L+"sql-wasm.wasm",t((await Ji(n)).instance))})(),a._sqlite3_free=t=>(a._sqlite3_free=v.P)(t),a._sqlite3_value_text=t=>(a._sqlite3_value_text=v.Q)(t),a._sqlite3_prepare_v2=(t,n,s,l,u)=>(a._sqlite3_prepare_v2=v.R)(t,n,s,l,u),a._sqlite3_step=t=>(a._sqlite3_step=v.S)(t),a._sqlite3_reset=t=>(a._sqlite3_reset=v.T)(t),a._sqlite3_exec=(t,n,s,l,u)=>(a._sqlite3_exec=v.U)(t,n,s,l,u),a._sqlite3_finalize=t=>(a._sqlite3_finalize=v.V)(t),a._sqlite3_column_name=(t,n)=>(a._sqlite3_column_name=v.W)(t,n),a._sqlite3_column_text=(t,n)=>(a._sqlite3_column_text=v.X)(t,n),a._sqlite3_column_type=(t,n)=>(a._sqlite3_column_type=v.Y)(t,n),a._sqlite3_errmsg=t=>(a._sqlite3_errmsg=v.Z)(t),a._sqlite3_clear_bindings=t=>(a._sqlite3_clear_bindings=v._)(t),a._sqlite3_value_blob=t=>(a._sqlite3_value_blob=v.$)(t),a._sqlite3_value_bytes=t=>(a._sqlite3_value_bytes=v.aa)(t),a._sqlite3_value_double=t=>(a._sqlite3_value_double=v.ba)(t),a._sqlite3_value_int=t=>(a._sqlite3_value_int=v.ca)(t),a._sqlite3_value_type=t=>(a._sqlite3_value_type=v.da)(t),a._sqlite3_result_blob=(t,n,s,l)=>(a._sqlite3_result_blob=v.ea)(t,n,s,l),a._sqlite3_result_double=(t,n)=>(a._sqlite3_result_double=v.fa)(t,n),a._sqlite3_result_error=(t,n,s)=>(a._sqlite3_result_error=v.ga)(t,n,s),a._sqlite3_result_int=(t,n)=>(a._sqlite3_result_int=v.ha)(t,n),a._sqlite3_result_int64=(t,n)=>(a._sqlite3_result_int64=v.ia)(t,n),a._sqlite3_result_null=t=>(a._sqlite3_result_null=v.ja)(t),a._sqlite3_result_text=(t,n,s,l)=>(a._sqlite3_result_text=v.ka)(t,n,s,l),a._sqlite3_aggregate_context=(t,n)=>(a._sqlite3_aggregate_context=v.la)(t,n),a._sqlite3_column_count=t=>(a._sqlite3_column_count=v.ma)(t),a._sqlite3_data_count=t=>(a._sqlite3_data_count=v.na)(t),a._sqlite3_column_blob=(t,n)=>(a._sqlite3_column_blob=v.oa)(t,n),a._sqlite3_column_bytes=(t,n)=>(a._sqlite3_column_bytes=v.pa)(t,n),a._sqlite3_column_double=(t,n)=>(a._sqlite3_column_double=v.qa)(t,n),a._sqlite3_bind_blob=(t,n,s,l,u)=>(a._sqlite3_bind_blob=v.ra)(t,n,s,l,u),a._sqlite3_bind_double=(t,n,s)=>(a._sqlite3_bind_double=v.sa)(t,n,s),a._sqlite3_bind_int=(t,n,s)=>(a._sqlite3_bind_int=v.ta)(t,n,s),a._sqlite3_bind_text=(t,n,s,l,u)=>(a._sqlite3_bind_text=v.ua)(t,n,s,l,u),a._sqlite3_bind_parameter_index=(t,n)=>(a._sqlite3_bind_parameter_index=v.va)(t,n),a._sqlite3_sql=t=>(a._sqlite3_sql=v.wa)(t),a._sqlite3_normalized_sql=t=>(a._sqlite3_normalized_sql=v.xa)(t),a._sqlite3_changes=t=>(a._sqlite3_changes=v.ya)(t),a._sqlite3_close_v2=t=>(a._sqlite3_close_v2=v.za)(t),a._sqlite3_create_function_v2=(t,n,s,l,u,p,b,T,I)=>(a._sqlite3_create_function_v2=v.Aa)(t,n,s,l,u,p,b,T,I),a._sqlite3_update_hook=(t,n,s)=>(a._sqlite3_update_hook=v.Ba)(t,n,s),a._sqlite3_open=(t,n)=>(a._sqlite3_open=v.Ca)(t,n);var Tr=a._malloc=t=>(Tr=a._malloc=v.Da)(t),xt=a._free=t=>(xt=a._free=v.Ea)(t);a._RegisterExtensionFunctions=t=>(a._RegisterExtensionFunctions=v.Fa)(t);var xn=(t,n)=>(xn=v.Ga)(t,n),In=(t,n)=>(In=v.Ha)(t,n),rt=t=>(rt=v.Ia)(t),ye=t=>(ye=v.Ja)(t),nt=()=>(nt=v.Ka)();a.stackSave=()=>nt(),a.stackRestore=t=>rt(t),a.stackAlloc=t=>ye(t),a.cwrap=(t,n,s,l)=>{var u=!s||s.every(p=>p==="number"||p==="boolean");return n!=="string"&&u&&!l?a["_"+t]:(...p)=>gs(t,n,s,p)},a.addFunction=tt,a.removeFunction=we,a.UTF8ToString=or,a.ALLOC_NORMAL=Ct,a.allocate=Nt,a.allocateUTF8OnStack=vr;function Ar(){function t(){if(a.calledRun=!0,!Ae){if(!a.noFSInit&&!dn){var n,s;dn=!0,l??=a.stdin,n??=a.stdout,s??=a.stderr,l?be("stdin",l):mr("/dev/tty","/dev/stdin"),n?be("stdout",null,n):mr("/dev/tty","/dev/stdout"),s?be("stderr",null,s):mr("/dev/tty1","/dev/stderr"),Oe("/dev/stdin",0),Oe("/dev/stdout",1),Oe("/dev/stderr",1)}if(v.N(),fn=!1,a.onRuntimeInitialized?.(),a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;){var l=a.postRun.shift();Zr.unshift(l)}Jr(Zr)}}if(0<_e)Ke=Ar;else{if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Zi();Jr(en),0<_e?Ke=Ar:a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),t()},1)):t()}}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return Ar(),i}),Gt)};typeof Qt=="object"&&typeof Me=="object"?(Me.exports=Yt,Me.exports.default=Yt):typeof define=="function"&&define.amd?define([],function(){return Yt}):typeof Qt=="object"&&(Qt.Module=Yt)});var Ya={};js(Ya,{default:()=>tr});module.exports=Ks(Ya);var bt=require("obsidian");var W=require("obsidian"),Pt=class extends W.PluginSettingTab{plugin;constructor(e,r){super(e,r),this.plugin=r}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"WeWe RSS Settings"}),e.createEl("div",{cls:"wewe-rss-settings-banner"}).createEl("p",{text:"Subscribe to WeChat public accounts and sync articles as Obsidian notes.",cls:"wewe-rss-settings-description"}),this.addSyncSettings(e),this.addNoteSettings(e),this.addContentSettings(e),this.addTitleFilteringSettings(e),this.addApiSettings(e),this.addAdvancedSettings(e)}addSyncSettings(e){e.createEl("h3",{text:"Sync Settings"}),new W.Setting(e).setName("Auto Sync").setDesc("Automatically sync feeds on schedule").addToggle(r=>r.setValue(this.plugin.settings.autoSync).onChange(async i=>{this.plugin.settings.autoSync=i,await this.plugin.saveSettings(),i?this.plugin.taskScheduler.registerTask("auto-sync",async()=>{await this.plugin.syncService.syncAll({staleThresholdHours:this.plugin.settings.syncInterval/60})},this.plugin.settings.syncInterval):this.plugin.taskScheduler.unregisterTask("auto-sync"),new W.Notice(`Auto-sync ${i?"enabled":"disabled"}`)})),new W.Setting(e).setName("Sync Interval").setDesc("How often to sync feeds (in minutes)").addSlider(r=>r.setLimits(15,360,15).setValue(this.plugin.settings.syncInterval).setDynamicTooltip().onChange(async i=>{this.plugin.settings.syncInterval=i,await this.plugin.saveSettings(),this.plugin.settings.autoSync&&this.plugin.taskScheduler.updateTaskInterval("auto-sync",i)})),new W.Setting(e).setName("Update Delay").setDesc("Delay between feed requests (seconds) - prevents rate limiting").addSlider(r=>r.setLimits(10,300,10).setValue(this.plugin.settings.updateDelay).setDynamicTooltip().onChange(async i=>{this.plugin.settings.updateDelay=i,await this.plugin.saveSettings()})),new W.Setting(e).setName("Max Articles Per Feed").setDesc("Maximum number of articles to fetch per feed").addSlider(r=>r.setLimits(10,500,10).setValue(this.plugin.settings.maxArticlesPerFeed).setDynamicTooltip().onChange(async i=>{this.plugin.settings.maxArticlesPerFeed=i,await this.plugin.saveSettings()}))}addNoteSettings(e){e.createEl("h3",{text:"Note Settings"}),new W.Setting(e).setName("Note Folder").setDesc("Folder where article notes will be created").addText(r=>r.setPlaceholder("WeWe RSS").setValue(this.plugin.settings.noteFolder).onChange(async i=>{this.plugin.settings.noteFolder=i,this.plugin.settings.noteLocation=i,await this.plugin.saveSettings()})),new W.Setting(e).setName("Add Tags").setDesc("Automatically add tags to created notes").addToggle(r=>r.setValue(this.plugin.settings.addTags).onChange(async i=>{this.plugin.settings.addTags=i,await this.plugin.saveSettings()})),new W.Setting(e).setName("Note Template").setDesc("Template for created notes. Available variables: {{title}}, {{feedName}}, {{url}}, {{publishedAt}}, {{content}}, {{tags}}, {{date}}").addTextArea(r=>{r.setPlaceholder("Enter your note template...").setValue(this.plugin.settings.noteTemplate).onChange(async i=>{this.plugin.settings.noteTemplate=i,await this.plugin.saveSettings()}),r.inputEl.rows=12,r.inputEl.cols=50}),new W.Setting(e).setName("Reset Template").setDesc("Reset note template to default").addButton(r=>r.setButtonText("Reset to Default").onClick(async()=>{let i=`---
title: {{title}}
url: {{url}}
published: {{publishedAt}}
feed: {{feedName}}
tags: [wewe-rss, {{feedName}}]
---

# {{title}}

> Published: {{publishedAt}}
> Source: [{{feedName}}]({{url}})

{{content}}
`;this.plugin.settings.noteTemplate=i,await this.plugin.saveSettings(),this.display(),new W.Notice("Template reset to default")}))}addContentSettings(e){e.createEl("h3",{text:"Content Settings"}),new W.Setting(e).setName("Feed Mode").setDesc("Summary (faster) or Full Text (slower, more content)").addDropdown(r=>r.addOption("summary","Summary").addOption("fulltext","Full Text").setValue(this.plugin.settings.feedMode).onChange(async i=>{this.plugin.settings.feedMode=i,await this.plugin.saveSettings()})),new W.Setting(e).setName("Clean HTML").setDesc("Remove scripts, styles, and other unnecessary HTML elements").addToggle(r=>r.setValue(this.plugin.settings.enableCleanHtml).onChange(async i=>{this.plugin.settings.enableCleanHtml=i,await this.plugin.saveSettings()}))}addTitleFilteringSettings(e){e.createEl("h3",{text:"Title Filtering"}),e.createEl("p",{text:"Use regex patterns to filter articles by title. Leave empty to include all articles.",cls:"setting-item-description"}),new W.Setting(e).setName("Include Patterns").setDesc("Only sync articles matching these patterns (comma-separated regex)").addTextArea(r=>{r.setPlaceholder("Example: AI, Machine Learning, \u4EBA\u5DE5\u667A\u80FD").setValue(this.plugin.settings.titleIncludePatterns.join(", ")).onChange(async i=>{this.plugin.settings.titleIncludePatterns=i.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()}),r.inputEl.rows=3}),new W.Setting(e).setName("Exclude Patterns").setDesc("Skip articles matching these patterns (comma-separated regex)").addTextArea(r=>{r.setPlaceholder("Example: \u5E7F\u544A, \u63A8\u5E7F, Advertisement").setValue(this.plugin.settings.titleExcludePatterns.join(", ")).onChange(async i=>{this.plugin.settings.titleExcludePatterns=i.split(",").map(o=>o.trim()).filter(o=>o.length>0),await this.plugin.saveSettings()}),r.inputEl.rows=3})}addApiSettings(e){e.createEl("h3",{text:"API Settings"}),new W.Setting(e).setName("Platform URL").setDesc("WeChat Reading API base URL (change only if you know what you're doing)").addText(r=>r.setPlaceholder("https://weread.111965.xyz").setValue(this.plugin.settings.platformUrl).onChange(async i=>{this.plugin.settings.platformUrl=i,await this.plugin.saveSettings()})),new W.Setting(e).setName("Max Requests Per Minute").setDesc("Rate limit for API requests (lower value = safer)").addSlider(r=>r.setLimits(10,120,10).setValue(this.plugin.settings.maxRequestsPerMinute).setDynamicTooltip().onChange(async i=>{this.plugin.settings.maxRequestsPerMinute=i,await this.plugin.saveSettings()}))}addAdvancedSettings(e){e.createEl("h3",{text:"Advanced"});let r=e.createEl("div",{cls:"wewe-rss-stats-container"});this.plugin.syncService.getSyncStats().then(i=>{r.createEl("p",{text:"\u{1F4CA} Database Statistics:",cls:"wewe-rss-stats-title"});let o=r.createEl("ul",{cls:"wewe-rss-stats-list"});o.createEl("li",{text:`Total Feeds: ${i.totalFeeds}`}),o.createEl("li",{text:`Total Articles: ${i.totalArticles}`}),o.createEl("li",{text:`Synced Articles: ${i.syncedArticles}`}),o.createEl("li",{text:`Unsynced Articles: ${i.unsyncedArticles}`});let a=this.plugin.databaseService.accounts.findAll();o.createEl("li",{text:`Accounts: ${a.length}`})}),new W.Setting(e).setName("Cleanup Old Articles").setDesc("Delete synced articles older than 30 days from database (notes are preserved)").addButton(i=>i.setButtonText("Clean Up").setWarning().onClick(async()=>{let o=await this.plugin.syncService.cleanupOldArticles(30);new W.Notice(`Cleaned up ${o} old articles`),this.display()})),new W.Setting(e).setName("Database Location").setDesc(`${this.plugin.settings.databasePath}`).setClass("wewe-rss-readonly-setting")}};var ke=require("obsidian");var zt=require("obsidian"),$i=Wn(Wi());var J=class{level=1;prefix;constructor(e="WeWe RSS"){this.prefix=e}setLevel(e){this.level=e}debug(...e){this.level<=0&&console.debug(`[${this.prefix}]`,...e)}info(...e){this.level<=1&&console.log(`[${this.prefix}]`,...e)}warn(...e){this.level<=2&&console.warn(`[${this.prefix}]`,...e)}error(...e){this.level<=3&&console.error(`[${this.prefix}]`,...e)}},m=new J;var Ge=class extends zt.Modal{plugin;logger;uuid=null;pollInterval=null;qrContainer;statusEl;consecutiveErrors=0;constructor(e,r){super(e),this.plugin=r,this.logger=new J("AddAccountModal")}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("wewe-rss-add-account-modal"),e.createEl("h2",{text:"Add WeChat Account"});let r=e.createEl("div",{cls:"wewe-rss-modal-instructions"});r.createEl("p",{text:"Scan the QR code with WeChat to authorize access to your reading list."}),r.createEl("p",{text:"Steps:",cls:"wewe-rss-instructions-title"});let i=r.createEl("ol",{cls:"wewe-rss-steps-list"});i.createEl("li",{text:"Open WeChat on your phone"}),i.createEl("li",{text:'Tap "Discover" \u2192 "Scan QR Code"'}),i.createEl("li",{text:"Scan the code below"}),i.createEl("li",{text:"Authorize the login on your phone"}),this.qrContainer=e.createEl("div",{cls:"wewe-rss-qr-container"}),this.qrContainer.createEl("div",{text:"Generating QR code...",cls:"wewe-rss-loading"}),this.statusEl=e.createEl("div",{cls:"wewe-rss-status-message"}),this.statusEl.createEl("p",{text:"Waiting for scan...",cls:"wewe-rss-status-text"});let o=e.createEl("div",{cls:"wewe-rss-modal-buttons"});o.createEl("button",{text:"Cancel",cls:"wewe-rss-btn"}).addEventListener("click",()=>{this.close()}),o.createEl("button",{text:"Refresh QR Code",cls:"wewe-rss-btn"}).addEventListener("click",async()=>{await this.generateQRCode()}),await this.generateQRCode()}async generateQRCode(){try{if(this.qrContainer.empty(),this.qrContainer.createEl("div",{text:"Checking server status...",cls:"wewe-rss-loading"}),!await this.plugin.accountService.checkServerHealth())throw new Error("WeChat Reading platform is currently unavailable. The server may be down or experiencing issues. Please try again later.");this.qrContainer.empty(),this.qrContainer.createEl("div",{text:"Generating QR code...",cls:"wewe-rss-loading"});let{uuid:r,scanUrl:i}=await this.plugin.accountService.createAccount();this.uuid=r,this.logger.info("QR code generated:",{uuid:r,scanUrl:i});let o=this.qrContainer.createEl("canvas",{cls:"wewe-rss-qr-code"});await $i.default.toCanvas(o,i,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}}),this.updateStatus("Please scan the QR code with WeChat","pending"),this.consecutiveErrors=0,this.startPolling()}catch(e){this.logger.error("Failed to generate QR code:",e),this.showError(e.message||"Failed to generate QR code. Please try again.")}}startPolling(){this.pollInterval&&window.clearInterval(this.pollInterval),this.pollInterval=window.setInterval(async()=>{await this.checkLoginStatus()},2e3),window.setTimeout(()=>{this.pollInterval&&(window.clearInterval(this.pollInterval),this.pollInterval=null,this.updateStatus("QR code expired. Please refresh to generate a new one.","error"))},5*60*1e3)}async checkLoginStatus(){if(this.uuid)try{let e=await this.plugin.accountService.checkLoginStatus(this.uuid);e?(this.logger.info("Account added successfully:",e),this.pollInterval&&(window.clearInterval(this.pollInterval),this.pollInterval=null),this.consecutiveErrors=0,this.updateStatus("Account added successfully!","success"),new zt.Notice(`WeChat account "${e.name}" added successfully!`),window.setTimeout(()=>{this.close()},1e3)):this.consecutiveErrors=0}catch(e){if(this.logger.error("Failed to check login status:",e),this.consecutiveErrors++,this.consecutiveErrors>=3){this.pollInterval&&(window.clearInterval(this.pollInterval),this.pollInterval=null);let r=e.message||"Failed to connect to server after multiple attempts";this.showError(r)}else this.updateStatus(`Connection issue (${this.consecutiveErrors}/3). Retrying...`,"pending")}}updateStatus(e,r){this.statusEl.empty();let i=this.statusEl.createEl("p",{cls:"wewe-rss-status-text"});r==="pending"?i.innerHTML=`<span class="wewe-rss-status-icon">\u23F3</span> ${e}`:r==="success"?i.innerHTML=`<span class="wewe-rss-status-icon" style="color: var(--color-green)">\u2713</span> ${e}`:r==="error"&&(i.innerHTML=`<span class="wewe-rss-status-icon" style="color: var(--color-red)">\u2717</span> ${e}`)}showError(e){this.qrContainer.empty();let r=this.qrContainer.createEl("div",{cls:"wewe-rss-error-container"});r.createEl("p",{text:e,cls:"wewe-rss-error-message"});let i=r.createEl("div",{cls:"wewe-rss-error-actions"});i.createEl("button",{text:"Try Again",cls:"wewe-rss-btn"}).addEventListener("click",async()=>{await this.generateQRCode()}),i.createEl("button",{text:"Check Server Status",cls:"wewe-rss-btn-secondary"}).addEventListener("click",()=>{window.open(`${this.plugin.settings.platformUrl}`,"_blank")}),this.updateStatus(e,"error")}onClose(){this.pollInterval&&(window.clearInterval(this.pollInterval),this.pollInterval=null);let{contentEl:e}=this;e.empty()}};var ne=require("obsidian");var Ye=class extends ne.Modal{plugin;logger;wxsLinkInput;submitBtn;isSubmitting=!1;constructor(e,r){super(e),this.plugin=r,this.logger=new J("AddFeedModal")}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("wewe-rss-add-feed-modal"),e.createEl("h2",{text:"Add WeChat Feed"});let r=e.createEl("div",{cls:"wewe-rss-modal-instructions"});r.createEl("p",{text:"Subscribe to a WeChat public account by pasting the share link below."});let i=r.createEl("ol",{cls:"wewe-rss-steps-list"});i.createEl("li",{text:"Open WeChat app and find the public account you want to follow"}),i.createEl("li",{text:'Tap the "..." menu and select "Share"'}),i.createEl("li",{text:"Copy the share link"}),i.createEl("li",{text:"Paste the link below"}),new ne.Setting(e).setName("WeChat Share Link").setDesc("Example: https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=...").addText(h=>{this.wxsLinkInput=h.inputEl,h.setPlaceholder("https://mp.weixin.qq.com/...").inputEl.addClass("wewe-rss-wide-input"),h.inputEl.addEventListener("keydown",g=>{g.key==="Enter"&&this.handleSubmit()})}),e.createEl("div",{cls:"wewe-rss-example-container"}).createEl("small",{text:'Tip: The link should start with "https://mp.weixin.qq.com/"',cls:"wewe-rss-hint-text"});let a=e.createEl("div",{cls:"wewe-rss-modal-buttons"});a.createEl("button",{text:"Cancel",cls:"wewe-rss-btn"}).addEventListener("click",()=>{this.close()}),this.submitBtn=a.createEl("button",{text:"Subscribe",cls:"wewe-rss-btn wewe-rss-btn-primary"}),this.submitBtn.addEventListener("click",()=>{this.handleSubmit()})}async handleSubmit(){if(this.isSubmitting)return;let e=this.wxsLinkInput.value.trim();if(!e){new ne.Notice("Please enter a WeChat share link");return}if(!e.includes("mp.weixin.qq.com")){new ne.Notice("Invalid WeChat share link. Please check the URL.");return}try{this.isSubmitting=!0,this.submitBtn.disabled=!0,this.submitBtn.textContent="Subscribing...",this.logger.info("Subscribing to feed:",e);let r=await this.plugin.feedService.subscribeFeed(e);if(this.logger.info("Feed subscribed successfully:",r),new ne.Notice(`Subscribed to "${r.title}"!`),await this.confirmFetchArticles(r.title)){this.submitBtn.textContent="Fetching articles...";try{let a=await this.plugin.feedService.fetchHistoricalArticles(r.id,r.feedId);new ne.Notice(`Downloaded ${a} articles from "${r.title}"`)}catch(a){this.logger.error("Failed to fetch articles:",a),new ne.Notice(`Feed subscribed, but failed to fetch articles: ${a.message}`)}}this.close();let o=this.app.workspace.getLeavesOfType("wewe-rss-view");if(o.length>0){let a=o[0].view;a.refresh&&await a.refresh()}}catch(r){this.logger.error("Failed to subscribe to feed:",r),new ne.Notice(`Failed to subscribe: ${r.message}`),this.submitBtn.disabled=!1,this.submitBtn.textContent="Subscribe",this.isSubmitting=!1}}async confirmFetchArticles(e){return new Promise(r=>{let i=new ne.Modal(this.app);i.contentEl.createEl("h3",{text:"Fetch Articles?"}),i.contentEl.createEl("p",{text:`Would you like to download recent articles from "${e}" now?`}),i.contentEl.createEl("p",{text:"This may take a few seconds. You can also sync later.",cls:"wewe-rss-hint-text"});let o=i.contentEl.createEl("div",{cls:"wewe-rss-modal-buttons"});o.createEl("button",{text:"Skip",cls:"wewe-rss-btn"}).addEventListener("click",()=>{i.close(),r(!1)}),o.createEl("button",{text:"Fetch Now",cls:"wewe-rss-btn wewe-rss-btn-primary"}).addEventListener("click",()=>{i.close(),r(!0)}),i.open()})}onClose(){let{contentEl:e}=this;e.empty(),this.isSubmitting=!1}};var ft="wewe-rss-view",Vt=class extends ke.ItemView{plugin;feedsContainer;articlesContainer;selectedFeedId=null;constructor(e,r){super(e),this.plugin=r}getViewType(){return ft}getDisplayText(){return"WeWe RSS"}getIcon(){return"rss"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("wewe-rss-sidebar"),this.renderHeader(e),await this.renderStats(e);let r=e.createEl("div",{cls:"wewe-rss-main-content"}),i=r.createEl("div",{cls:"wewe-rss-feeds-section"});i.createEl("h5",{text:"Feeds"}),this.feedsContainer=i.createEl("div",{cls:"wewe-rss-feeds-list"});let o=r.createEl("div",{cls:"wewe-rss-articles-section"});o.createEl("h5",{text:"Articles"}),this.articlesContainer=o.createEl("div",{cls:"wewe-rss-articles-list"}),await this.refresh()}renderHeader(e){let r=e.createEl("div",{cls:"wewe-rss-header"});r.createEl("h4",{text:"WeWe RSS"}).addClass("wewe-rss-title");let o=r.createEl("div",{cls:"wewe-rss-button-group"});o.createEl("button",{text:"+ Account",cls:"wewe-rss-btn wewe-rss-btn-small"}).addEventListener("click",()=>{new Ge(this.app,this.plugin).open()}),o.createEl("button",{text:"+ Feed",cls:"wewe-rss-btn wewe-rss-btn-small"}).addEventListener("click",()=>{new Ye(this.app,this.plugin).open()}),o.createEl("button",{text:"\u27F3 Sync",cls:"wewe-rss-btn wewe-rss-btn-small wewe-rss-btn-primary"}).addEventListener("click",async()=>{await this.handleSync()})}async renderStats(e){let r=await this.plugin.syncService.getSyncStats(),i=e.createEl("div",{cls:"wewe-rss-stats-bar"});if(i.createEl("span",{text:`\u{1F4DA} ${r.totalFeeds} feeds`,cls:"wewe-rss-stat"}),i.createEl("span",{text:`\u{1F4C4} ${r.totalArticles} articles`,cls:"wewe-rss-stat"}),r.unsyncedArticles>0&&i.createEl("span",{text:`\u26A0\uFE0F ${r.unsyncedArticles} unsynced`,cls:"wewe-rss-stat wewe-rss-stat-warning"}),r.lastSyncTime){let o=this.getTimeAgo(r.lastSyncTime);i.createEl("span",{text:`\u{1F552} Last sync: ${o}`,cls:"wewe-rss-stat wewe-rss-stat-muted"})}}async renderFeeds(){this.feedsContainer.empty();let e=this.plugin.databaseService.feeds.findAll();if(e.length===0){this.feedsContainer.createEl("div",{text:'No feeds yet. Click "+ Feed" to add one.',cls:"wewe-rss-empty-state"});return}for(let r of e){let i=this.feedsContainer.createEl("div",{cls:"wewe-rss-feed-item"});this.selectedFeedId===r.id&&i.addClass("wewe-rss-feed-item-selected");let o=i.createEl("div",{text:r.title,cls:"wewe-rss-feed-title"}),a=i.createEl("div",{cls:"wewe-rss-feed-stats"}),d=this.plugin.databaseService.articles.countByFeed(r.id);if(a.createEl("span",{text:`${d} articles`,cls:"wewe-rss-feed-count"}),r.lastSyncAt){let h=this.getTimeAgo(new Date(r.lastSyncAt));a.createEl("span",{text:h,cls:"wewe-rss-feed-sync-time"})}i.addEventListener("click",()=>{this.selectedFeedId=r.id,this.renderFeeds(),this.renderArticles()})}}async renderArticles(){this.articlesContainer.empty();let e;if(this.selectedFeedId?e=this.plugin.databaseService.articles.findByFeedId(this.selectedFeedId,50):e=this.plugin.databaseService.articles.findRecent(20),e.length===0){this.articlesContainer.createEl("div",{text:"No articles yet. Sync feeds to download articles.",cls:"wewe-rss-empty-state"});return}for(let r of e){let i=this.articlesContainer.createEl("div",{cls:"wewe-rss-article-item"});r.synced&&i.addClass("wewe-rss-article-synced");let o=i.createEl("div",{text:r.title,cls:"wewe-rss-article-title"}),a=i.createEl("div",{cls:"wewe-rss-article-meta"}),d=new Date(r.publishedAt);a.createEl("span",{text:d.toLocaleDateString(),cls:"wewe-rss-article-date"}),r.synced&&r.noteId&&a.createEl("span",{text:"\u{1F4DD} Note",cls:"wewe-rss-article-note-link"}).addEventListener("click",async g=>{g.stopPropagation();let S=this.plugin.noteCreator.getNote(r.noteId);S?await this.app.workspace.getLeaf().openFile(S):new ke.Notice("Note not found")}),i.addEventListener("click",async()=>{if(r.synced){if(r.noteId){let h=this.plugin.noteCreator.getNote(r.noteId);h&&await this.app.workspace.getLeaf().openFile(h)}}else{let h=this.plugin.databaseService.feeds.findById(r.feedId);if(h){let g=await this.plugin.noteCreator.createNoteFromArticle(r,h);g&&(new ke.Notice("Note created!"),await this.app.workspace.getLeaf().openFile(g),await this.refresh())}}})}}async handleSync(){let e=this.containerEl.querySelector(".wewe-rss-btn-primary");if(e)try{e.disabled=!0,e.textContent="\u27F3 Syncing...";let r=await this.plugin.syncService.syncAll();new ke.Notice(`Sync complete! ${r.feedsRefreshed} feeds, ${r.articlesDownloaded} articles, ${r.notesCreated} notes created`),await this.refresh()}catch(r){new ke.Notice(`Sync failed: ${r.message}`)}finally{e.disabled=!1,e.textContent="\u27F3 Sync"}}async refresh(){await this.renderFeeds(),await this.renderArticles();let e=this.containerEl.querySelector(".wewe-rss-stats-bar");e&&(e.empty(),await this.renderStats(this.containerEl.children[1]))}getTimeAgo(e){let r=Math.floor((Date.now()-e.getTime())/1e3);return r<60?"just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<604800?`${Math.floor(r/86400)}d ago`:e.toLocaleDateString()}async onClose(){}};var Yi=require("obsidian");var zi=Wn(Hi());var jr=class{SQL=null;initialized=!1;async initialize(){if(this.initialized){m.debug("sql.js already initialized");return}try{m.info("Initializing sql.js..."),this.SQL=await(0,zi.default)({locateFile:e=>`https://sql.js.org/dist/${e}`}),this.initialized=!0,m.info("sql.js initialized successfully")}catch(e){throw m.error("Failed to initialize sql.js:",e),new Error("Failed to initialize database engine")}}createDatabase(){if(!this.SQL)throw new Error("sql.js not initialized. Call initialize() first.");return m.debug("Creating new in-memory database"),new this.SQL.Database}loadDatabase(e){if(!this.SQL)throw new Error("sql.js not initialized. Call initialize() first.");return m.debug("Loading database from buffer"),new this.SQL.Database(e)}exportDatabase(e){return m.debug("Exporting database to buffer"),e.export()}isInitialized(){return this.initialized}},ht=new jr;var Vi="wewe-rss.db";var Gi={databasePath:".obsidian/plugins/wewe-rss/data.db",syncSchedule:"35 5,17 * * *",autoSync:!0,syncInterval:60,updateDelay:60,maxArticlesPerFeed:100,noteFolder:"WeWe RSS",noteLocation:"WeWe RSS",noteTemplate:`---
title: {{title}}
url: {{url}}
published: {{publishedAt}}
feed: {{feedName}}
tags: [wewe-rss, {{feedName}}]
---

# {{title}}

> Published: {{publishedAt}}
> Source: [{{feedName}}]({{url}})

{{content}}
`,addTags:!0,titleIncludePatterns:[],titleExcludePatterns:[],platformUrl:"https://weread.111965.xyz",maxRequestsPerMinute:60,feedMode:"summary",enableCleanHtml:!1};var pt=class{db;constructor(e){this.db=e}async create(e,r){let i=Date.now();this.db.execute(`INSERT INTO accounts (name, cookie, status, created_at, updated_at)
			VALUES (?, ?, ?, ?, ?)`,[e,r,"active",i,i]);let o=this.db.getLastInsertId();return m.info("Account created:",{id:o,name:e}),{id:o,name:e,cookie:r,status:"active",createdAt:i,updatedAt:i}}findById(e){let r=this.db.queryOne("SELECT * FROM accounts WHERE id = ?",[e]);return r?this.mapToAccount(r):null}findAll(){return this.db.query("SELECT * FROM accounts ORDER BY created_at DESC").map(r=>this.mapToAccount(r))}findActive(){return this.db.query(`SELECT * FROM accounts
			WHERE status = ? OR status = ?
			ORDER BY created_at DESC`,["active","blacklisted"]).map(r=>this.mapToAccount(r))}findByStatus(e){return this.db.query("SELECT * FROM accounts WHERE status = ? ORDER BY created_at DESC",[e]).map(i=>this.mapToAccount(i))}updateStatus(e,r,i){let o=Date.now();i!==void 0?this.db.execute(`UPDATE accounts
				SET status = ?, blacklisted_until = ?, updated_at = ?
				WHERE id = ?`,[r,i,o,e]):this.db.execute(`UPDATE accounts
				SET status = ?, blacklisted_until = NULL, updated_at = ?
				WHERE id = ?`,[r,o,e]),m.info("Account status updated:",{id:e,status:r,blacklistedUntil:i})}blacklist(e,r=24*60*60*1e3){let i=Date.now()+r;this.updateStatus(e,"blacklisted",i),m.warn("Account blacklisted until:",new Date(i).toISOString())}checkAndClearBlacklist(e){let r=this.findById(e);return r&&r.status==="blacklisted"&&r.blacklistedUntil&&Date.now()>r.blacklistedUntil?(this.updateStatus(e,"active"),m.info("Account blacklist cleared:",e),!0):!1}updateCookie(e,r){let i=Date.now();this.db.execute("UPDATE accounts SET cookie = ?, updated_at = ? WHERE id = ?",[r,i,e]),m.info("Account cookie updated:",e)}updateName(e,r){let i=Date.now();this.db.execute("UPDATE accounts SET name = ?, updated_at = ? WHERE id = ?",[r,i,e]),m.info("Account name updated:",{id:e,name:r})}delete(e){this.db.execute("DELETE FROM accounts WHERE id = ?",[e]),m.info("Account deleted:",e)}count(){return this.db.queryOne("SELECT COUNT(*) as count FROM accounts")?.count||0}countByStatus(e){return this.db.queryOne("SELECT COUNT(*) as count FROM accounts WHERE status = ?",[e])?.count||0}mapToAccount(e){return{id:e.id,name:e.name,cookie:e.cookie,status:e.status,blacklistedUntil:e.blacklisted_until||void 0,createdAt:e.created_at,updatedAt:e.updated_at}}};var gt=class{db;constructor(e){this.db=e}async create(e,r,i,o){let a=Date.now(),d=this.findByFeedId(e);if(d)return m.warn("Feed already exists:",e),d;this.db.execute(`INSERT INTO feeds (feed_id, title, description, account_id, created_at, updated_at)
			VALUES (?, ?, ?, ?, ?, ?)`,[e,r,i,o,a,a]);let h=this.db.getLastInsertId();return m.info("Feed created:",{id:h,feedId:e,title:r}),{id:h,feedId:e,title:r,description:i,accountId:o,createdAt:a,updatedAt:a}}findById(e){let r=this.db.queryOne("SELECT * FROM feeds WHERE id = ?",[e]);return r?this.mapToFeed(r):null}findByFeedId(e){let r=this.db.queryOne("SELECT * FROM feeds WHERE feed_id = ?",[e]);return r?this.mapToFeed(r):null}findAll(){return this.db.query("SELECT * FROM feeds ORDER BY created_at DESC").map(r=>this.mapToFeed(r))}findByAccountId(e){return this.db.query("SELECT * FROM feeds WHERE account_id = ? ORDER BY created_at DESC",[e]).map(i=>this.mapToFeed(i))}findNeedingSync(e=60*60*1e3){let r=Date.now()-e;return this.db.query(`SELECT * FROM feeds
			WHERE last_sync_at IS NULL OR last_sync_at < ?
			ORDER BY last_sync_at ASC NULLS FIRST`,[r]).map(o=>this.mapToFeed(o))}updateMetadata(e,r,i){let o=Date.now();this.db.execute("UPDATE feeds SET title = ?, description = ?, updated_at = ? WHERE id = ?",[r,i,o,e]),m.info("Feed metadata updated:",{id:e,title:r})}updateLastSync(e,r){let i=r||Date.now(),o=Date.now();this.db.execute("UPDATE feeds SET last_sync_at = ?, updated_at = ? WHERE id = ?",[i,o,e]),m.debug("Feed sync timestamp updated:",{id:e,syncTime:i})}updateAccount(e,r){let i=Date.now();this.db.execute("UPDATE feeds SET account_id = ?, updated_at = ? WHERE id = ?",[r,i,e]),m.info("Feed account updated:",{id:e,accountId:r})}delete(e){this.db.execute("DELETE FROM feeds WHERE id = ?",[e]),m.info("Feed deleted:",e)}deleteByFeedId(e){this.db.execute("DELETE FROM feeds WHERE feed_id = ?",[e]),m.info("Feed deleted by feedId:",e)}count(){return this.db.queryOne("SELECT COUNT(*) as count FROM feeds")?.count||0}countByAccount(e){return this.db.queryOne("SELECT COUNT(*) as count FROM feeds WHERE account_id = ?",[e])?.count||0}getFeedStats(){return this.db.query(`SELECT f.*, COUNT(a.id) as article_count
			FROM feeds f
			LEFT JOIN articles a ON a.feed_id = f.id
			GROUP BY f.id
			ORDER BY f.created_at DESC`).map(r=>({...this.mapToFeed(r),articleCount:r.article_count||0}))}mapToFeed(e){return{id:e.id,feedId:e.feed_id,title:e.title,description:e.description||"",accountId:e.account_id,lastSyncAt:e.last_sync_at||void 0,createdAt:e.created_at,updatedAt:e.updated_at}}};var mt=class{db;constructor(e){this.db=e}async create(e,r,i,o,a,d){let h=Date.now(),g=this.findByUrl(a);if(g)return m.debug("Article already exists:",a),g;this.db.execute(`INSERT INTO articles (feed_id, title, content, content_html, url, published_at, created_at)
			VALUES (?, ?, ?, ?, ?, ?, ?)`,[e,r,i,o,a,d,h]);let S=this.db.getLastInsertId();return m.info("Article created:",{id:S,title:r}),{id:S,feedId:e,title:r,content:i,contentHtml:o,url:a,publishedAt:d,synced:!1,createdAt:h}}async createBatch(e){if(e.length===0)return 0;let r=Date.now(),i=0;this.db.beginTransaction();try{for(let o of e)this.findByUrl(o.url)||(this.db.execute(`INSERT INTO articles (feed_id, title, content, content_html, url, published_at, created_at)
					VALUES (?, ?, ?, ?, ?, ?, ?)`,[o.feedId,o.title,o.content,o.contentHtml,o.url,o.publishedAt,r]),i++);this.db.commit(),m.info("Batch articles created:",i)}catch(o){throw this.db.rollback(),m.error("Failed to create batch articles:",o),o}return i}findAll(){return this.db.query("SELECT * FROM articles ORDER BY published_at DESC").map(r=>this.mapToArticle(r))}findById(e){let r=this.db.queryOne("SELECT * FROM articles WHERE id = ?",[e]);return r?this.mapToArticle(r):null}findByUrl(e){let r=this.db.queryOne("SELECT * FROM articles WHERE url = ?",[e]);return r?this.mapToArticle(r):null}findByFeedId(e,r){let i=r?"SELECT * FROM articles WHERE feed_id = ? ORDER BY published_at DESC LIMIT ?":"SELECT * FROM articles WHERE feed_id = ? ORDER BY published_at DESC",o=r?[e,r]:[e];return this.db.query(i,o).map(d=>this.mapToArticle(d))}findUnsynced(e){let r=e?"SELECT * FROM articles WHERE synced = 0 ORDER BY published_at DESC LIMIT ?":"SELECT * FROM articles WHERE synced = 0 ORDER BY published_at DESC",i=e?[e]:[];return this.db.query(r,i).map(a=>this.mapToArticle(a))}findUnsyncedByFeed(e,r){let i=r?"SELECT * FROM articles WHERE feed_id = ? AND synced = 0 ORDER BY published_at DESC LIMIT ?":"SELECT * FROM articles WHERE feed_id = ? AND synced = 0 ORDER BY published_at DESC",o=r?[e,r]:[e];return this.db.query(i,o).map(d=>this.mapToArticle(d))}findRecent(e=50){return this.db.query("SELECT * FROM articles ORDER BY published_at DESC LIMIT ?",[e]).map(i=>this.mapToArticle(i))}searchByTitle(e,r=50){return this.db.query("SELECT * FROM articles WHERE title LIKE ? ORDER BY published_at DESC LIMIT ?",[`%${e}%`,r]).map(o=>this.mapToArticle(o))}markAsSynced(e,r){this.db.execute("UPDATE articles SET synced = 1, note_id = ? WHERE id = ?",[r,e]),m.debug("Article marked as synced:",{id:e,noteId:r})}markBatchAsSynced(e){if(e.length!==0){this.db.beginTransaction();try{for(let r of e)this.db.execute("UPDATE articles SET synced = 1 WHERE id = ?",[r]);this.db.commit(),m.info("Batch articles marked as synced:",e.length)}catch(r){throw this.db.rollback(),m.error("Failed to mark batch as synced:",r),r}}}update(e,r){let i=[],o=[];r.title!==void 0&&(i.push("title = ?"),o.push(r.title)),r.content!==void 0&&(i.push("content = ?"),o.push(r.content)),r.contentHtml!==void 0&&(i.push("content_html = ?"),o.push(r.contentHtml)),r.noteId!==void 0&&(i.push("note_id = ?"),o.push(r.noteId)),r.synced!==void 0&&(i.push("synced = ?"),o.push(r.synced?1:0)),i.length!==0&&(o.push(e),this.db.execute(`UPDATE articles SET ${i.join(", ")} WHERE id = ?`,o),m.info("Article updated:",e))}updateContent(e,r,i){this.db.execute("UPDATE articles SET content = ?, content_html = ? WHERE id = ?",[r,i,e]),m.info("Article content updated:",e)}delete(e){this.db.execute("DELETE FROM articles WHERE id = ?",[e]),m.info("Article deleted:",e)}deleteByFeedId(e){this.db.execute("DELETE FROM articles WHERE feed_id = ?",[e]),m.info("Articles deleted for feed:",e)}deleteOlderThan(e){let i=this.db.query("SELECT COUNT(*) as count FROM articles WHERE published_at < ?",[e])[0]?.count||0;return i>0&&(this.db.execute("DELETE FROM articles WHERE published_at < ?",[e]),m.info("Old articles deleted:",i)),i}cleanupSynced(e=30){let r=Date.now()-e*24*60*60*1e3,o=this.db.query("SELECT COUNT(*) as count FROM articles WHERE synced = 1 AND published_at < ?",[r])[0]?.count||0;return o>0&&(this.db.execute("DELETE FROM articles WHERE synced = 1 AND published_at < ?",[r]),m.info("Synced articles cleaned up:",o)),o}count(){return this.db.queryOne("SELECT COUNT(*) as count FROM articles")?.count||0}countByFeed(e){return this.db.queryOne("SELECT COUNT(*) as count FROM articles WHERE feed_id = ?",[e])?.count||0}countUnsynced(){return this.db.queryOne("SELECT COUNT(*) as count FROM articles WHERE synced = 0")?.count||0}getStats(){let e=this.count(),r=this.count()-this.countUnsynced(),i=this.countUnsynced(),a=this.db.query("SELECT feed_id, COUNT(*) as count FROM articles GROUP BY feed_id").map(d=>({feedId:d.feed_id,count:d.count}));return{total:e,synced:r,unsynced:i,byFeed:a}}mapToArticle(e){return{id:e.id,feedId:e.feed_id,title:e.title,content:e.content,contentHtml:e.content_html,url:e.url,publishedAt:e.published_at,synced:e.synced===1,noteId:e.note_id||void 0,createdAt:e.created_at}}};var jt=class{plugin;db=null;initialized=!1;dbPath;saveTimer=null;accounts;feeds;articles;constructor(e){this.plugin=e,this.dbPath=(0,Yi.normalizePath)(`${e.manifest.dir}/${Vi}`),this.accounts=new pt(this),this.feeds=new gt(this),this.articles=new mt(this)}async initialize(){if(this.initialized){m.debug("Database already initialized");return}try{if(m.info("Initializing database..."),await ht.initialize(),await this.plugin.app.vault.adapter.exists(this.dbPath)){m.info("Loading existing database from:",this.dbPath);let r=await this.plugin.app.vault.adapter.readBinary(this.dbPath);this.db=ht.loadDatabase(new Uint8Array(r)),m.info("Database loaded successfully")}else m.info("Creating new database"),this.db=ht.createDatabase(),await this.runMigrations(),await this.save(),m.info("New database created and saved");this.initialized=!0,this.setupAutoSave()}catch(e){throw m.error("Failed to initialize database:",e),e}}async runMigrations(){if(!this.db)throw new Error("Database not initialized");m.info("Running database migrations..."),this.db.run(`
			CREATE TABLE IF NOT EXISTS migrations (
				id INTEGER PRIMARY KEY AUTOINCREMENT,
				name TEXT NOT NULL UNIQUE,
				applied_at INTEGER NOT NULL
			)
		`);let e=this.db.exec(`
			SELECT name FROM migrations WHERE name = '001_initial'
		`);e.length===0||e[0].values.length===0?(m.info("Running migration: 001_initial"),await this.runInitialMigration(),this.db.run(`
				INSERT INTO migrations (name, applied_at)
				VALUES ('001_initial', ?)
			`,[Date.now()]),m.info("Migration 001_initial completed")):m.info("Database already migrated")}async runInitialMigration(){if(!this.db)throw new Error("Database not initialized");this.db.run(`
			CREATE TABLE IF NOT EXISTS accounts (
				id INTEGER PRIMARY KEY AUTOINCREMENT,
				name TEXT NOT NULL,
				cookie TEXT NOT NULL,
				status TEXT NOT NULL DEFAULT 'active',
				blacklisted_until INTEGER,
				created_at INTEGER NOT NULL,
				updated_at INTEGER NOT NULL
			)
		`),this.db.run(`
			CREATE TABLE IF NOT EXISTS feeds (
				id INTEGER PRIMARY KEY AUTOINCREMENT,
				feed_id TEXT NOT NULL UNIQUE,
				title TEXT NOT NULL,
				description TEXT,
				account_id INTEGER NOT NULL,
				last_sync_at INTEGER,
				created_at INTEGER NOT NULL,
				updated_at INTEGER NOT NULL,
				FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE
			)
		`),this.db.run(`
			CREATE TABLE IF NOT EXISTS articles (
				id INTEGER PRIMARY KEY AUTOINCREMENT,
				feed_id INTEGER NOT NULL,
				title TEXT NOT NULL,
				content TEXT NOT NULL,
				content_html TEXT NOT NULL,
				url TEXT NOT NULL UNIQUE,
				published_at INTEGER NOT NULL,
				synced INTEGER NOT NULL DEFAULT 0,
				note_id TEXT,
				created_at INTEGER NOT NULL,
				FOREIGN KEY (feed_id) REFERENCES feeds(id) ON DELETE CASCADE
			)
		`),this.db.run(`
			CREATE TABLE IF NOT EXISTS settings (
				key TEXT PRIMARY KEY,
				value TEXT NOT NULL
			)
		`),this.db.run("CREATE INDEX IF NOT EXISTS idx_feeds_feed_id ON feeds(feed_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_articles_feed_id ON articles(feed_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_articles_url ON articles(url)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_articles_synced ON articles(synced)"),m.info("Initial database schema created")}async save(){if(!this.db){m.warn("Cannot save: database not initialized");return}try{m.debug("Saving database to:",this.dbPath);let e=ht.exportDatabase(this.db),r=this.dbPath.substring(0,this.dbPath.lastIndexOf("/"));await this.plugin.app.vault.adapter.exists(r)||await this.plugin.app.vault.adapter.mkdir(r);let i=e.buffer.slice(0);await this.plugin.app.vault.adapter.writeBinary(this.dbPath,i),m.debug("Database saved successfully")}catch(e){throw m.error("Failed to save database:",e),e}}setupAutoSave(){this.saveTimer&&clearInterval(this.saveTimer),this.saveTimer=setInterval(async()=>{await this.save()},3e4),m.info("Auto-save enabled (30s interval)")}async close(){this.saveTimer&&(clearInterval(this.saveTimer),this.saveTimer=null),this.db&&(await this.save(),this.db.close(),this.db=null,m.info("Database connection closed")),this.initialized=!1}query(e,r=[]){if(!this.initialized||!this.db)throw new Error("Database not initialized");try{let i=this.db.exec(e,r);if(i.length===0)return[];let o=i[0].columns;return i[0].values.map(d=>{let h={};return o.forEach((g,S)=>{h[g]=d[S]}),h})}catch(i){throw m.error("Query failed:",e,i),i}}queryOne(e,r=[]){let i=this.query(e,r);return i.length>0?i[0]:null}execute(e,r=[]){if(!this.initialized||!this.db)throw new Error("Database not initialized");try{this.db.run(e,r)}catch(i){throw m.error("Execute failed:",e,i),i}}getLastInsertId(){if(!this.db)throw new Error("Database not initialized");return this.db.exec("SELECT last_insert_rowid() as id")[0].values[0][0]}beginTransaction(){this.execute("BEGIN TRANSACTION")}commit(){this.execute("COMMIT")}rollback(){this.execute("ROLLBACK")}};var Qi=require("obsidian");var Qe=class{baseUrl;timeout=15e3;constructor(e){this.baseUrl=e}async checkHealth(){try{m.info("Checking API health...");let e=[`${this.baseUrl}/health`,`${this.baseUrl}/api/health`,`${this.baseUrl}/api/v2/health`];for(let r of e)try{let i=await this.request({url:r,method:"GET"},5e3);if(i&&(i.status==="ok"||i.status==="degraded"))return m.info("API health check passed:",r),!0}catch{continue}try{return await this.request({url:this.baseUrl,method:"HEAD"},3e3),m.info("Base URL reachable (no health endpoint found)"),!0}catch(r){return m.warn("API health check failed:",r),!1}}catch(e){return m.error("Health check error:",e),!1}}async createLoginUrl(){try{m.info("Creating login URL...");let e=await this.request({url:`${this.baseUrl}/api/v2/login/platform`,method:"GET"});return m.info("Login URL created:",e.uuid),e}catch(e){throw m.error("Failed to create login URL:",e),this.handleError(e)}}async getLoginResult(e){try{m.debug("Checking login result for UUID:",e);let r=await this.request({url:`${this.baseUrl}/api/v2/login/platform/${e}`,method:"GET"},12e4,void 0,{maxRetries:2,backoffMs:2e3});return r.token&&r.vid?m.info("Login successful:",r.username):m.debug("Login pending:",r.message),r}catch(r){throw m.error("Failed to get login result:",r),this.handleError(r)}}async getMpInfo(e){try{m.info("Getting MP info from link:",e);let r=await this.request({url:`${this.baseUrl}/api/v2/platform/wxs2mp`,method:"POST",body:JSON.stringify({url:e.trim()}),headers:{"Content-Type":"application/json"}});return m.info("MP info retrieved:",r.length>0?r[0].name:"none"),r}catch(r){throw m.error("Failed to get MP info:",r),this.handleError(r)}}async getMpInfoWithAuth(e,r,i){try{return m.info("Getting MP info with auth:",e),await this.request({url:`${this.baseUrl}/api/v2/platform/wxs2mp`,method:"POST",body:JSON.stringify({url:e.trim()}),headers:{"Content-Type":"application/json",xid:r,Authorization:`Bearer ${i}`}})}catch(o){throw m.error("Failed to get MP info with auth:",o),this.handleError(o,r)}}async getMpArticles(e,r,i,o=1){try{m.debug(`Getting articles for MP: ${e}, page: ${o}`);let a=await this.request({url:`${this.baseUrl}/api/v2/platform/mps/${e}/articles`,method:"GET",headers:{xid:r,Authorization:`Bearer ${i}`},contentType:"application/json"},void 0,{page:o.toString()});return m.info(`Retrieved ${a.length} articles for ${e}, page ${o}`),a}catch(a){throw m.error(`Failed to get articles for ${e}:`,a),this.handleError(a,r)}}async request(e,r,i,o){if(i){let h=new URLSearchParams(i);e.url=`${e.url}?${h.toString()}`}e.headers||(e.headers={});let a=o?.maxRetries??0,d=o?.backoffMs??1e3;for(let h=0;h<=a;h++)try{m.debug("API Request:",{url:e.url,method:e.method,attempt:h+1,maxRetries:a+1});let g=await(0,Qi.requestUrl)(e);if(g.status>=200&&g.status<300)return m.debug("API Request Success:",{url:e.url,status:g.status}),g.json;throw new Error(`HTTP ${g.status}: ${g.text}`)}catch(g){let S=h===a,_=this.isRetryableError(g);if(m.error("API Request Failed:",{url:e.url,method:e.method,attempt:h+1,maxRetries:a+1,error:g.message,isRetryable:_,isLastAttempt:S}),!S&&_){let M=d*Math.pow(2,h);m.info(`Retrying in ${M}ms...`),await this.sleep(M);continue}throw g}throw new Error("Request failed: max retries exceeded")}isRetryableError(e){let i=(e.message||e.toString()).match(/HTTP (\d+)/);if(i){let o=parseInt(i[1],10);return o>=500&&o<=504}return!1}sleep(e){return new Promise(r=>setTimeout(r,e))}handleError(e,r){let i=e.message||e.toString(),o=i.match(/HTTP (\d+)/),a=o?o[1]:null;return a==="500"?{code:"WeReadError500",message:`Server error (HTTP 500). The WeChat Reading platform (${this.baseUrl}) is experiencing issues. Please try again later or check if the server is operational.`,details:e}:a==="502"?{code:"WeReadError502",message:"Bad gateway error (HTTP 502). The WeChat Reading platform may be temporarily unavailable. Please try again in a few minutes.",details:e}:a==="503"?{code:"WeReadError503",message:"Service unavailable (HTTP 503). The WeChat Reading platform is temporarily down for maintenance. Please try again later.",details:e}:i.includes("WeReadError401")?{code:"WeReadError401",message:`Account (${r}) authentication expired`,details:e}:i.includes("WeReadError429")?{code:"WeReadError429",message:`Account (${r}) rate limited (\u5C0F\u9ED1\u5C4B)`,details:e}:i.includes("WeReadError400")?{code:"WeReadError400",message:"Invalid request parameters",details:e}:{code:"WeReadError500",message:i,details:e}}setPlatformUrl(e){this.baseUrl=e,m.info("Platform URL updated:",e)}getPlatformUrl(){return this.baseUrl}};var Kt=class{plugin;apiClient;constructor(e){this.plugin=e,this.apiClient=new Qe(e.settings.platformUrl)}async createAccount(){try{m.info("Starting account creation...");let e=await this.apiClient.createLoginUrl();return m.info("Login QR code generated:",e.scanUrl),{uuid:e.uuid,scanUrl:e.scanUrl}}catch(e){throw m.error("Failed to create account:",e),e}}async checkServerHealth(){try{return await this.apiClient.checkHealth()}catch(e){return m.error("Server health check failed:",e),!1}}async checkLoginStatus(e){try{let r=await this.apiClient.getLoginResult(e);if(r.token&&r.vid&&r.username){let i=await this.plugin.databaseService.accounts.create(r.username,r.token);return m.info("Account created successfully:",i.name),i}return null}catch(r){throw m.error("Failed to check login status:",r),r}}async getAvailableAccount(){let e=this.plugin.databaseService.accounts.findActive();if(e.length===0)return m.warn("No active accounts available"),null;for(let o of e)o.status==="blacklisted"&&this.plugin.databaseService.accounts.checkAndClearBlacklist(o.id);let r=this.plugin.databaseService.accounts.findByStatus("active");if(r.length===0)return m.warn("No active accounts (all blacklisted or disabled)"),null;let i=r[0];return m.debug("Selected account:",i.id),i}async handleApiError(e,r){let i=r;if(!i.code){m.debug("Non-API error, skipping account status update");return}switch(i.code){case"WeReadError401":m.warn(`Account ${e} expired, marking as invalid`),this.plugin.databaseService.accounts.updateStatus(e,"expired");break;case"WeReadError429":m.warn(`Account ${e} rate limited, blacklisting`),this.plugin.databaseService.accounts.blacklist(e,864e5);break;case"WeReadError400":m.error(`Bad request with account ${e}:`,i.message);break;default:m.error(`Unhandled API error for account ${e}:`,i)}}async updateAccountToken(e,r){this.plugin.databaseService.accounts.updateCookie(e,r),m.info("Account token updated:",e)}async updateAccountName(e,r){this.plugin.databaseService.accounts.updateName(e,r),m.info("Account name updated:",e)}async setAccountStatus(e,r){this.plugin.databaseService.accounts.updateStatus(e,r),m.info(`Account ${e} status updated to:`,r)}async deleteAccount(e){this.plugin.databaseService.accounts.delete(e),m.info("Account deleted:",e)}getAllAccounts(){return this.plugin.databaseService.accounts.findAll()}getAccount(e){return this.plugin.databaseService.accounts.findById(e)}getAccountStats(){return{total:this.plugin.databaseService.accounts.count(),active:this.plugin.databaseService.accounts.countByStatus("active"),disabled:this.plugin.databaseService.accounts.countByStatus("disabled"),expired:this.plugin.databaseService.accounts.countByStatus("expired"),blacklisted:this.plugin.databaseService.accounts.countByStatus("blacklisted")}}setPlatformUrl(e){this.apiClient.setPlatformUrl(e),m.info("Platform URL updated in AccountService")}};var Xt=class{plugin;apiClient;constructor(e){this.plugin=e,this.apiClient=new Qe(e.settings.platformUrl)}async subscribeFeed(e){try{m.info("Subscribing to feed:",e);let r=await this.apiClient.getMpInfo(e);if(!r||r.length===0)throw new Error("Failed to get MP info from share link");let i=r[0],o=this.plugin.databaseService.feeds.findByFeedId(i.id);if(o)return m.info("Feed already exists:",i.name),o;let a=await this.plugin.accountService.getAvailableAccount();if(!a)throw new Error("No available accounts to subscribe to feed");let d=await this.plugin.databaseService.feeds.create(i.id,i.name,i.intro||"",a.id);return m.info("Feed subscribed successfully:",d.title),this.fetchHistoricalArticles(d.id,i.id).catch(h=>{m.error("Failed to fetch historical articles:",h)}),d}catch(r){throw m.error("Failed to subscribe to feed:",r),r}}async fetchHistoricalArticles(e,r,i=5){try{m.info(`Fetching historical articles for ${r}...`);let o=this.plugin.databaseService.feeds.findById(e);if(!o)throw new Error("Feed not found");let a=this.plugin.databaseService.accounts.findById(o.accountId);if(!a)throw new Error("Feed account not found");let d=0,h=1;for(;h<=i;)try{let g=await this.apiClient.getMpArticles(r,a.id.toString(),a.cookie,h);if(g.length===0){m.info(`No more articles on page ${h}`);break}let S=g.map(M=>({feedId:e,title:M.title,content:"",contentHtml:"",url:`https://mp.weixin.qq.com/s/${M.id}`,publishedAt:M.publishTime*1e3})),_=await this.plugin.databaseService.articles.createBatch(S);d+=_,m.info(`Fetched ${_} articles from page ${h}`),h<i&&await this.delay(this.plugin.settings.updateDelay*1e3),h++}catch(g){m.error(`Failed to fetch articles on page ${h}:`,g),await this.plugin.accountService.handleApiError(a.id,g);break}return this.plugin.databaseService.feeds.updateLastSync(e),m.info(`Fetched ${d} historical articles for ${r}`),d}catch(o){throw m.error("Failed to fetch historical articles:",o),o}}async refreshFeed(e){try{let r=this.plugin.databaseService.feeds.findById(e);if(!r)throw new Error("Feed not found");m.info("Refreshing feed:",r.title);let i=this.plugin.databaseService.accounts.findById(r.accountId);if(!i)throw new Error("Feed account not found");let o=await this.apiClient.getMpArticles(r.feedId,i.id.toString(),i.cookie,1);if(o.length===0)return m.info("No new articles found"),this.plugin.databaseService.feeds.updateLastSync(e),0;let a=o.map(h=>({feedId:e,title:h.title,content:"",contentHtml:"",url:`https://mp.weixin.qq.com/s/${h.id}`,publishedAt:h.publishTime*1e3})),d=await this.plugin.databaseService.articles.createBatch(a);return this.plugin.databaseService.feeds.updateLastSync(e),m.info(`Refreshed ${d} new articles for ${r.title}`),d}catch(r){m.error("Failed to refresh feed:",r);let i=this.plugin.databaseService.feeds.findById(e);throw i&&await this.plugin.accountService.handleApiError(i.accountId,r),r}}async refreshAllFeeds(){let e=this.plugin.databaseService.feeds.findAll(),r={total:e.length,successful:0,failed:0};m.info(`Refreshing ${e.length} feeds...`);for(let i of e)try{await this.refreshFeed(i.id),r.successful++,r.successful<e.length&&await this.delay(this.plugin.settings.updateDelay*1e3)}catch(o){m.error(`Failed to refresh feed ${i.title}:`,o),r.failed++}return m.info(`Refresh complete: ${r.successful}/${r.total} successful`),r}async refreshStaleFeeds(e=1){let r=e*60*60*1e3,i=this.plugin.databaseService.feeds.findNeedingSync(r);m.info(`Found ${i.length} stale feeds to refresh`);let o=0;for(let a of i)try{await this.refreshFeed(a.id),o++,o<i.length&&await this.delay(this.plugin.settings.updateDelay*1e3)}catch(d){m.error(`Failed to refresh stale feed ${a.title}:`,d)}return m.info(`Refreshed ${o} stale feeds`),o}async updateFeedMetadata(e,r,i){this.plugin.databaseService.feeds.updateMetadata(e,r,i),m.info("Feed metadata updated:",e)}async deleteFeed(e){this.plugin.databaseService.articles.deleteByFeedId(e),this.plugin.databaseService.feeds.delete(e),m.info("Feed deleted:",e)}getAllFeeds(){return this.plugin.databaseService.feeds.findAll()}getFeed(e){return this.plugin.databaseService.feeds.findById(e)}getFeedStats(){return this.plugin.databaseService.feeds.getFeedStats()}setPlatformUrl(e){this.apiClient.setPlatformUrl(e),m.info("Platform URL updated in FeedService")}delay(e){return new Promise(r=>setTimeout(r,e))}};var pe=require("obsidian");function ji(c){return new Date(c).toLocaleString()}function Kr(c){return c.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim()}var Jt=class{plugin;app;logger;constructor(e){this.plugin=e,this.app=e.app,this.logger=new J("NoteCreator")}async createNoteFromArticle(e,r){try{let{noteLocation:i,noteTemplate:o,addTags:a}=this.plugin.settings,d=this.generateNotePath(e,r,i),h=this.app.vault.getAbstractFileByPath(d);if(h instanceof pe.TFile)return this.logger.warn(`Note already exists: ${d}`),h;let g={title:e.title,feedName:r.title,publishedAt:ji(e.publishedAt),url:e.url,tags:a?this.extractTags(r.title):[]},S=this.generateNoteContent(e,g,o);await this.ensureFolderExists(d);let _=await this.app.vault.create(d,S);return this.logger.info(`Created note: ${d}`),_}catch(i){return this.logger.error(`Failed to create note for article ${e.id}:`,i),null}}async createNotesFromArticles(e,r){let i=0,o=0,a=0;for(let d of e){let h=r.get(d.feedId);if(!h){this.logger.warn(`Feed not found for article ${d.id}`),a++;continue}let g=await this.createNoteFromArticle(d,h);g?await this.findExistingNoteId(d.url)?o++:(i++,await this.updateArticleNoteId(d.id,g.path)):a++}return{created:i,skipped:o,failed:a}}generateNotePath(e,r,i){let o=Kr(r.title),a=Kr(e.title);return(0,pe.normalizePath)(`${i}/${o}/${a}.md`)}generateNoteContent(e,r,i){let o=i.replace(/\{\{title\}\}/g,r.title).replace(/\{\{feedName\}\}/g,r.feedName).replace(/\{\{author\}\}/g,r.author||"Unknown").replace(/\{\{publishedAt\}\}/g,r.publishedAt).replace(/\{\{url\}\}/g,r.url).replace(/\{\{date\}\}/g,new Date().toISOString().split("T")[0]).replace(/\{\{tags\}\}/g,r.tags.map(a=>`#${a}`).join(" "));return o=o.replace(/\{\{content\}\}/g,e.content),o}extractTags(e){return["wewe-rss",e.replace(/[^a-zA-Z0-9\u4e00-\u9fa5\s]/g,"").replace(/\s+/g,"-").toLowerCase()].filter(Boolean)}async ensureFolderExists(e){let r=e.substring(0,e.lastIndexOf("/"));if(!r)return;let i=this.app.vault.getAbstractFileByPath(r);if(!i)await this.app.vault.createFolder(r),this.logger.debug(`Created folder: ${r}`);else if(!(i instanceof pe.TFolder))throw new Error(`Path exists but is not a folder: ${r}`)}async findExistingNoteId(e){let r=this.app.vault.getMarkdownFiles();for(let i of r)if((await this.app.vault.read(i)).includes(e))return i.path;return null}async updateArticleNoteId(e,r){try{this.plugin.databaseService.articles.update(e,{noteId:r,synced:!0}),this.logger.debug(`Updated article ${e} with noteId: ${r}`)}catch(i){this.logger.error(`Failed to update article ${e}:`,i)}}async deleteNote(e){try{let r=this.app.vault.getAbstractFileByPath(e);return r instanceof pe.TFile?(await this.app.vault.delete(r),this.logger.info(`Deleted note: ${e}`),!0):!1}catch(r){return this.logger.error(`Failed to delete note ${e}:`,r),!1}}async updateNote(e,r){try{let i=this.app.vault.getAbstractFileByPath(e);return i instanceof pe.TFile?(await this.app.vault.modify(i,r),this.logger.info(`Updated note: ${e}`),!0):!1}catch(i){return this.logger.error(`Failed to update note ${e}:`,i),!1}}getNote(e){let r=this.app.vault.getAbstractFileByPath(e);return r instanceof pe.TFile?r:null}noteExists(e){return this.getNote(e)!==null}};var Zt=class{plugin;logger;isSyncing=!1;lastSyncTime=null;constructor(e){this.plugin=e,this.logger=new J("SyncService")}async syncAll(e={}){if(this.isSyncing)throw this.logger.warn("Sync already in progress, skipping..."),new Error("Sync already in progress");this.isSyncing=!0;let r={feedsRefreshed:0,feedsFailed:0,articlesDownloaded:0,notesCreated:0,notesSkipped:0,notesFailed:0,errors:[]};try{this.logger.info("Starting sync...",e);let i=await this.refreshFeeds(e);if(r.feedsRefreshed=i.successful,r.feedsFailed=i.failed,r.articlesDownloaded=i.articlesDownloaded,r.errors.push(...i.errors),e.createNotes!==!1){let o=await this.createNotesForUnsyncedArticles();r.notesCreated=o.created,r.notesSkipped=o.skipped,r.notesFailed=o.failed}return this.lastSyncTime=new Date,this.logger.info("Sync completed successfully",r),r}catch(i){throw this.logger.error("Sync failed:",i),r.errors.push(i.message),i}finally{this.isSyncing=!1}}async refreshFeeds(e){let{staleThresholdHours:r,feedIds:i}=e,o={successful:0,failed:0,articlesDownloaded:0,errors:[]},a;i&&i.length>0?a=i.map(d=>this.plugin.databaseService.feeds.findById(d)).filter(d=>d!==null):r!==void 0?a=this.plugin.databaseService.feeds.findNeedingSync(r):a=this.plugin.databaseService.feeds.findAll(),this.logger.info(`Refreshing ${a.length} feeds...`);for(let d of a)try{let h=await this.plugin.feedService.refreshFeed(d.id);o.articlesDownloaded+=h,o.successful++,this.logger.debug(`Refreshed feed ${d.title}: ${h} new articles`)}catch(h){o.failed++;let g=`Failed to refresh feed ${d.title}: ${h.message}`;o.errors.push(g),this.logger.error(g)}return o}async createNotesForUnsyncedArticles(){let e=this.plugin.databaseService.articles.findUnsynced();if(e.length===0)return this.logger.info("No unsynced articles found"),{created:0,skipped:0,failed:0};this.logger.info(`Creating notes for ${e.length} unsynced articles...`);let r=new Map,i=[...new Set(e.map(a=>a.feedId))];for(let a of i){let d=this.plugin.databaseService.feeds.findById(a);d&&r.set(a,d)}let o=await this.plugin.noteCreator.createNotesFromArticles(e,r);return this.logger.info("Note creation completed",o),o}async syncFeed(e){return this.syncAll({feedIds:[e],createNotes:!0})}async downloadArticlesOnly(e={}){return this.syncAll({...e,createNotes:!1})}async createNotesManually(){if(this.isSyncing)throw new Error("Sync already in progress");this.isSyncing=!0;try{return await this.createNotesForUnsyncedArticles()}finally{this.isSyncing=!1}}isRunning(){return this.isSyncing}getLastSyncTime(){return this.lastSyncTime}async getSyncStats(){let e=this.plugin.databaseService.feeds.findAll(),r=this.plugin.databaseService.articles.findAll(),i=this.plugin.databaseService.articles.findUnsynced();return{totalFeeds:e.length,totalArticles:r.length,unsyncedArticles:i.length,syncedArticles:r.length-i.length,lastSyncTime:this.lastSyncTime,isSyncing:this.isSyncing}}async cleanupOldArticles(e=30){try{let r=this.plugin.databaseService.articles.cleanupSynced(e);return this.logger.info(`Cleaned up ${r} old articles (retention: ${e} days)`),r}catch(r){throw this.logger.error("Failed to cleanup old articles:",r),r}}};var er=class{plugin;logger;tasks=new Map;tickInterval=null;TICK_INTERVAL_MS=6e4;constructor(e){this.plugin=e,this.logger=new J("TaskScheduler")}start(){if(this.tickInterval!==null){this.logger.warn("Scheduler already running");return}this.logger.info("Starting task scheduler..."),this.tick(),this.tickInterval=window.setInterval(()=>{this.tick()},this.TICK_INTERVAL_MS),this.logger.info("Task scheduler started")}stop(){if(this.tickInterval===null){this.logger.warn("Scheduler not running");return}this.logger.info("Stopping task scheduler..."),window.clearInterval(this.tickInterval),this.tickInterval=null,this.logger.info("Task scheduler stopped")}registerTask(e,r,i){this.tasks.has(e)&&this.logger.warn(`Task ${e} already registered, updating...`);let o=new Date,a=new Date(o.getTime()+i*6e4),d={id:e,callback:r,intervalMinutes:i,lastRun:null,nextRun:a,enabled:!0};this.tasks.set(e,d),this.logger.info(`Registered task: ${e} (interval: ${i}m, next run: ${a.toISOString()})`)}unregisterTask(e){let r=this.tasks.delete(e);return r&&this.logger.info(`Unregistered task: ${e}`),r}enableTask(e){let r=this.tasks.get(e);return r?(r.enabled=!0,this.logger.info(`Enabled task: ${e}`),!0):(this.logger.warn(`Task not found: ${e}`),!1)}disableTask(e){let r=this.tasks.get(e);return r?(r.enabled=!1,this.logger.info(`Disabled task: ${e}`),!0):(this.logger.warn(`Task not found: ${e}`),!1)}updateTaskInterval(e,r){let i=this.tasks.get(e);if(!i)return this.logger.warn(`Task not found: ${e}`),!1;i.intervalMinutes=r;let o=new Date;return i.lastRun?i.nextRun=new Date(i.lastRun.getTime()+r*6e4):i.nextRun=new Date(o.getTime()+r*6e4),this.logger.info(`Updated task interval: ${e} (new interval: ${r}m, next run: ${i.nextRun.toISOString()})`),!0}async runTaskNow(e){let r=this.tasks.get(e);if(!r)throw new Error(`Task not found: ${e}`);this.logger.info(`Running task immediately: ${e}`),await this.executeTask(r)}getTaskStatus(e){return this.tasks.get(e)||null}getAllTasks(){return Array.from(this.tasks.values())}isRunning(){return this.tickInterval!==null}async tick(){let e=new Date,r=[];for(let i of this.tasks.values())i.enabled&&e>=i.nextRun&&r.push(i);if(r.length!==0){this.logger.debug(`Found ${r.length} due tasks`);for(let i of r)await this.executeTask(i)}}async executeTask(e){let r=Date.now();try{this.logger.info(`Executing task: ${e.id}`),await e.callback();let i=Date.now()-r;this.logger.info(`Task ${e.id} completed in ${i}ms`)}catch(i){this.logger.error(`Task ${e.id} failed:`,i)}finally{let i=new Date;e.lastRun=i,e.nextRun=new Date(i.getTime()+e.intervalMinutes*6e4),this.logger.debug(`Task ${e.id} next run: ${e.nextRun.toISOString()}`)}}clearAllTasks(){let e=this.tasks.size;this.tasks.clear(),this.logger.info(`Cleared ${e} tasks`)}};var tr=class extends bt.Plugin{settings;databaseService;accountService;feedService;noteCreator;syncService;taskScheduler;async onload(){console.log("Loading WeWe RSS plugin"),await this.loadSettings(),this.databaseService=new jt(this),await this.databaseService.initialize(),this.accountService=new Kt(this),this.feedService=new Xt(this),this.noteCreator=new Jt(this),this.syncService=new Zt(this),this.taskScheduler=new er(this),this.taskScheduler.start(),this.settings.autoSync&&this.taskScheduler.registerTask("auto-sync",async()=>{await this.syncService.syncAll({staleThresholdHours:this.settings.syncInterval/60})},this.settings.syncInterval),this.registerView(ft,r=>new Vt(r,this)),this.addRibbonIcon("rss","WeWe RSS",()=>{this.activateView()}),this.addCommand({id:"open-wewe-rss-sidebar",name:"Open WeWe RSS Sidebar",callback:()=>{this.activateView()}}),this.addCommand({id:"sync-all-feeds",name:"Sync All Feeds Now",callback:async()=>{try{let r=await this.syncService.syncAll();new bt.Notice(`Sync complete! ${r.feedsRefreshed} feeds, ${r.articlesDownloaded} articles, ${r.notesCreated} notes created`)}catch(r){new bt.Notice(`Sync failed: ${r.message}`)}}}),this.addCommand({id:"add-new-feed",name:"Add New Feed",callback:()=>{new Ye(this.app,this).open()}}),this.addCommand({id:"add-wechat-account",name:"Add WeChat Account",callback:()=>{new Ge(this.app,this).open()}}),this.addCommand({id:"export-opml",name:"Export OPML",callback:()=>{console.log("Exporting OPML...")}}),this.addSettingTab(new Pt(this.app,this));let e=this.addStatusBarItem();e.setText("WeWe RSS: Idle"),e.addClass("wewe-rss-status-bar")}onunload(){console.log("Unloading WeWe RSS plugin"),this.taskScheduler&&this.taskScheduler.stop(),this.databaseService&&this.databaseService.close()}async loadSettings(){this.settings=Object.assign({},Gi,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:e}=this.app,r=null,i=e.getLeavesOfType(ft);if(i.length>0)r=i[0];else{let o=e.getRightLeaf(!1);o&&(r=o,await r.setViewState({type:ft,active:!0}))}r&&e.revealLeaf(r)}};
